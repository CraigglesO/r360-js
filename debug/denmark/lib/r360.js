/*
 Route360° JavaScript API v0.0.9 (9ec6272), a JS library for leaflet maps. http://route360.net
 (c) 2014 Henning Hollburg and Daniel Gerber, (c) 2014 Motion Intelligence GmbH
*/
function GoogleMapsPolygonLayer(t,e){this.map=t,this.id=this.map.getDiv().id,this.inverse=!1,this.topRight={lat:-90,lng:-180},this.bottomLeft={lat:-90,lng:180},this.multiPolygons=[],this.opacity=r360.config.defaultPolygonLayerOptions.opacity,this.strokeWidth=r360.config.defaultPolygonLayerOptions.strokeWidth,this.backgroundColor=r360.config.defaultPolygonLayerOptions.backgroundColor,this.backgroundOpacity=r360.config.defaultPolygonLayerOptions.backgroundOpacity,this.tolerance=r360.config.defaultPolygonLayerOptions.tolerance,this.extendWidthX=r360.config.defaultPolygonLayerOptions.strokeWidth/2,this.extendWidthY=r360.config.defaultPolygonLayerOptions.strokeWidth/2,"undefined"!=typeof e&&("undefined"!=typeof e.opacity&&(this.opacity=e.opacity),"undefined"!=typeof e.strokeWidth&&(this.strokeWidth=e.strokeWidth),"undefined"!=typeof e.inverse&&(this.inverse=e.inverse),"undefined"!=typeof e.tolerance&&(this.tolerance=e.tolerance),"undefined"!=typeof e.extendWidthX&&(this.extendWidthX=e.extendWidthX),"undefined"!=typeof e.extendWidthY&&(this.extendWidthY=e.extendWidthY)),this.element=null,this.setMap(this.map),this.addListener()}!function(t,e,n){function o(){var e=t.r360;s.noConflict=function(){return t.r360=e,this},t.r360=s}var s={version:"v0.0.9"};"object"==typeof module&&"object"==typeof module.exports?module.exports=s:"function"==typeof define&&define.amd?define(s):o(),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,i=function(){},o=function(){return n.apply(this instanceof i&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,o.prototype=new i,o}),s.config={serviceUrl:"https://api.route360.net/api_dev/",nominatimUrl:"https://geocode.route360.net/",osmServiceUrl:"https://api.route360.net/r360-osm-api-norway/",serviceVersion:"v1",pathSerializer:"compact",requestTimeout:1e4,maxRoutingTime:3600,bikeSpeed:15,bikeUphill:20,bikeDownhill:-10,walkSpeed:5,walkUphill:10,walkDownhill:0,travelTimes:[300,600,900,1200,1500,1800],travelType:"walk",logging:!1,defaultTravelTimeControlOptions:{travelTimes:[{time:300,color:"#006837",opacity:.1},{time:600,color:"#39B54A",opacity:.2},{time:900,color:"#8CC63F",opacity:.3},{time:1200,color:"#F7931E",opacity:.4},{time:1500,color:"#F15A24",opacity:.5},{time:1800,color:"#C1272D",opacity:1}],position:"topright",label:"travel time",initValue:30},routeTypes:[{routeType:"WALK",color:"red",haloColor:"white"},{routeType:"BIKE",color:"#558D54",haloColor:"white"},{routeType:"CAR",color:"#558D54",haloColor:"white"},{routeType:"TRANSFER",color:"#C1272D",haloColor:"white"},{routeType:102,color:"#006837",haloColor:"white"},{routeType:400,color:"#156ab8",haloColor:"white"},{routeType:900,color:"red",haloColor:"white"},{routeType:700,color:"#A3007C",haloColor:"white"},{routeType:1e3,color:"blue",haloColor:"white"},{routeType:109,color:"#006F35",haloColor:"white"},{routeType:100,color:"red",haloColor:"white"},{routeType:1,color:"red",haloColor:"red"},{routeType:2,color:"blue",haloColor:"blue"},{routeType:3,color:"yellow",haloColor:"yellow"},{routeType:0,color:"green",haloColor:"green"},{routeType:4,color:"orange",haloColor:"orange"},{routeType:5,color:"red",haloColor:"red"},{routeType:6,color:"blue",haloColor:"blue"},{routeType:7,color:"yellow",haloColor:"yellow"}],defaultPlaceAutoCompleteOptions:{serviceUrl:"https://geocode.route360.net/solr/select?",position:"topleft",reset:!1,reverse:!1,autoHide:!0,placeholder:"Select source",maxRows:5,width:300},photonPlaceAutoCompleteOptions:{serviceUrl:"https://geocode2.route360.net/photon/api?",position:"topleft",reset:!1,reverse:!1,placeholder:"Select source",maxRows:5,width:300},defaultRadioOptions:{position:"topright"},defaultPolygonLayerOptions:{opacity:.4,strokeWidth:30,tolerance:15,backgroundColor:"black",backgroundOpacity:.5,inverse:!1,animate:!1,animationDuration:1},i18n:{language:"en",configuredLanguages:["en","de","no"],info:{en:"More information",de:"Mehr informationen",no:"Mer Informasjon"},fullscreen:{en:"Fullscreen",de:"Vollbild",no:"Fullskjerm"},slow:{en:"Slow",de:"Langsam",no:"Sakte"},low:{en:"Low",de:"Gering",no:"Lav"},medium:{en:"Medium",de:"Mittel",no:"Medium"},fast:{en:"Fast",de:"Schnell",no:"Raskt"},high:{en:"High",de:"Hoch",no:"Høy"},departure:{en:"Departure",de:"Abfahrt",no:"TODO TRANSLATION: "},placeholderSrc:{en:"Select source!",de:"Start wählen!",no:"Start"},placeholderTrg:{en:"Select target!",de:"Ziel wählen!",no:"Mål"},line:{en:"Line",de:"Linie",no:"TODO TRANSLATION: "},arrival:{en:"Arrival",de:"Ankunft",no:"TODO TRANSLATION: "},from:{en:"From",de:"Von",no:"TODO TRANSLATION: "},to:{en:"To",de:"Nach",no:"TODO TRANSLATION: "},travelTime:{en:"Travel time",de:"Reisezeit",no:"Reisetid"},totalTime:{en:"Total time",de:"Gesamtzeit",no:"TODO TRANSLATION: "},batteryCapacity:{en:"Battery capacity",de:"Akkuleistung",no:"Batterikapasitet"},distance:{en:"Distance",de:"Distanz",no:"Avstand"},wait:{en:"Please wait!",de:"Bitte warten!",no:"Vennligst vent!"},polygonWait:{en:"Calculating reachable area!",de:"Berechne erreichbare Fläche!",no:"Vennligst vent!"},routeWait:{en:"Searching route to target(s)!",de:"Suche Route zum Ziel!",no:"Vennligst vent!"},timeWait:{en:"Getting travel times to target(s)!",de:"Berechne Reisezeiten für Ziele!",no:"Vennligst vent!"},osmWait:{en:"Searching for points of interests!",de:"Suche nach Sehenswürdigkeiten!",no:"Vennligst vent!"},populationWait:{en:"Calculating population statistics!",de:"Berechne Bevölkerungsstatistik!",no:"Vennligst vent!"},elevation:{en:"Elevation",de:"Höhenunterschied",no:"Stigning"},timeFormat:{en:"a.m.",de:"Uhr",no:"TODO_TRANSLATION"},reset:{en:"Reset input",de:"Eingeben löschen",no:"Reset"},reverse:{en:"Switch source and target",de:"Start und Ziel tauschen",no:"Motsatt"},settings:{en:"Switch travel type",de:"Reisemodus wechseln",no:"Reisemåte"},noRouteFound:{en:"No route found!",de:"Keine Route gefunden!",no:"TODO TRANSLATION"},monthNames:{en:["January","February","March","April","May","June","July","August","September","October","November","December"],de:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],no:["TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION"]},dayNames:{en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],de:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],no:["TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION"]},dayNamesMin:{en:["Su","Mo","Tu","We","Th","Fr","Sa"],de:["So","Mo","Di","Mi","Do","Fr","Sa"],no:["TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION"]},museum:{en:"Museum",de:"Museum",no:"Museum"},swimming_pool:{en:"Swimming pool",de:"Schwimmbad",no:"Svømmebassenger"},restaurant:{en:"Restaurant",de:"Restaurant",no:"Restaurant"},cinema:{en:"Cinema",de:"Kino",no:"Kino"},theater:{en:"Theater",de:"Theater",no:"Teater"},library:{en:"Library",de:"Bibliothek",no:"Bibliotek"},bike_rental_station:{en:"Bike rental station",de:"Fahrradleihstation",no:"TODO TRANSLATION"},cycling_speed_help:{en:"Cycling speed: {}km/h",de:"Fahrradgeschwindigkeit: {}km/h",no:"G Fart: {}km/h, Fart: {}km/h"},walking_speed_help:{en:"Walk speed: {}km/h",de:"Laufgeschwindigkeit: {}km/h",no:"Fart: {}km/h"},walking_and_cycling_speed_help:{en:"Walk speed: {}km/h, Cycling speed: {}km/h",de:"Laufgeschwindigkeit: {}km/h, Fahrradgeschwindigkeit: {}km/h",no:"Fart: {}km/h (Gå), Fart: {}km/h (Sykle)"},ebike_speed_help_fast:{en:"Little support from the pedelec",de:"Keine Unterstützung durch das Pedelec",no:"Høy egeninnsats - Lav motorinnsats"},ebike_speed_help_medium:{en:"Medium support from the pedelec",de:"Mittlere Unterstützung durch das Pedelec",no:"Medium egeninnsats - Medium motorinnsats"},ebike_speed_help_slow:{en:"Full support from the pedelec",de:"Volle Unterstützung durch das Pedelec",no:"Lav egeninnsats - Høy motorinnsats"},contribution:{en:"Personal contribution",de:"Eigenleistung",no:"Egeninnsats"},low_contribution:{en:"Low personal contribution",de:"Geringe Eigenleistung",no:"Lav Egeninnsats"},switchLanguage:function(){var t=[];_.each(s.config.i18n.configuredLanguages,function(e){t.push("[lang='"+e+"']")}),$(t.join(", ")).hide(),$("[lang='"+s.config.i18n.language+"']").show()},getSpan:function(t){var e="";return _.each(_.keys(s.config.i18n[t]),function(n){e+='<span lang="'+n+'">'+s.config.i18n[t][n]+"</span>"}),e},getSpan:function(t,e){var n="";return _.each(_.keys(s.config.i18n[t]),function(i){var o=s.config.i18n[t][i];_.each(e,function(t){o=o.replace("{}",t)}),n+='<span lang="'+i+'">'+o+"</span>"}),""==n?"_"+t+"_":n},get:function(t){var e;return _.each(_.keys(s.config.i18n),function(n){t==n&&(e=s.config.i18n[t][s.config.i18n.language])}),e}}},s.PolygonUtil={clip:function(t,e){var n,o,s,a,r=function(t){return(o[0]-n[0])*(t[1]-n[1])>(o[1]-n[1])*(t[0]-n[0])},l=function(){var t=[n[0]-o[0],n[1]-o[1]],e=[s[0]-a[0],s[1]-a[1]],i=n[0]*o[1]-n[1]*o[0],r=s[0]*a[1]-s[1]*a[0],l=1/(t[0]*e[1]-t[1]*e[0]);return[(i*e[0]-r*t[0])*l,(i*e[1]-r*t[1])*l]},p=t,n=e[e.length-1];for(j in e){var o=e[j],d=p;p=[],s=d[d.length-1];for(i in d){var a=d[i];r(a)?(r(s)||p.push(l()),p.push(a)):r(s)&&p.push(l()),s=a}n=o}return p},isCollinear:function(t,e,n){if(t.x==n.x&&t.y==n.y)return!1;if(t.x==e.x&&e.x==n.x)return!0;if(t.y==e.y&&e.y==n.y)return!0;var i=t.x*(e.y-n.y)+e.x*(n.y-t.y)+n.x*(t.y-e.y);return i<s.config.defaultPolygonLayerOptions.tolerance&&i>-s.config.defaultPolygonLayerOptions.tolerance&&t.x!=n.x&&t.y!=n.y?!0:!1},scale:function(t,e){return t.x*=e,t.y*=e,t},subtract:function(t,e,n){return t.x-=e,t.y-=n,t},divide:function(t,e){return t.x/=e,t.y/=e,t},roundPoint:function(t){return t.x=Math.round(t.x),t.y=Math.round(t.y),t},buildPath:function(t,e){return[e,Math.round(t.x),Math.round(t.y)]},getEuclidianDistance:function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},getSvgFrame:function(t,e){return[["M",0,0],["L",t,0],["L",t,e],["L",0,e],["z"]]},extendBounds:function(t,e,n){var i=Math.ceil(e),o=Math.ceil(n);return t.max.x+=i,t.min.x-=i,t.max.y+=o,t.min.y-=o,t},prepareMultipolygons:function(t,e,n){for(var i=[],o=0;o<t.length;o++)for(var a=0;a<t[o].polygons.length;a++){var r=t[o].polygons[a];r.project(),s.PolygonUtil.updateBoundingBox(r,e,n),s.PolygonUtil.addPolygonToMultiPolygon(i,r)}return i.sort(function(t,e){return e.getTravelTime()-t.getTravelTime()}),i},updateBoundingBox:function(t,e,n){t.topRight.lat>e.lat&&(e.lat=t.topRight.lat),t.topRight.lng>e.lng&&(e.lng=t.topRight.lng),t.bottomLeft.lat<n.lat&&(n.lat=t.bottomLeft.lat),t.bottomLeft.lng<n.lng&&(n.lng=t.bottomLeft.lng)},addPolygonToMultiPolygon:function(t,e){var n=_.filter(t,function(t){return t.getTravelTime()==e.travelTime});if(n.length>0)n[0].addPolygon(e);else{var i=new s.multiPolygon;i.setTravelTime(e.travelTime),i.addPolygon(e),i.setColor(e.getColor()),i.setOpacity(e.getOpacity()),t.push(i)}}},s.SvgUtil={getGElement:function(t,e){var n=s.Util.generateId(),i=e.opacity;return"<g id="+n+" style='opacity:"+i+"'><path style='stroke: "+e.color+"; fill: "+e.color+" ; stroke-opacity: 1; stroke-width: "+e.strokeWidth+"; fill-opacity:1'd='"+t.toString().replace(/\,/g," ")+"'/></g>"},getInverseSvgElement:function(t,e){var n=s.PolygonUtil.getSvgFrame(e.svgWidth,e.svgHeight),i="<div id=svg_"+e.id+" style='"+s.Util.getTranslation(e.offset)+";''><svg height="+e.svgHeight+" width="+e.svgWidth+" style='fill:"+e.backgroundColor+" ; opacity: "+e.backgroundOpacity+"; stroke-width: "+e.strokeWidth+"; stroke-linejoin:round; stroke-linecap:round; fill-rule: evenodd' xmlns='http://www.w3.org/2000/svg'>",o="</svg></div>",a="<defs><mask id='mask_"+e.id+"'><path style='fill-opacity:1;stroke: white; fill:white;' d='"+n.toString().replace(/\,/g," ")+"'/>"+t.join("")+"</mask></defs>",r="<path style='mask: url(#mask_"+e.id+")' d='"+n.toString().replace(/\,/g," ")+"'/>";return i+r+a+o},getNormalSvgElement:function(t,e){var n="<div id=svg_"+e.id+" style='"+s.Util.getTranslation(e.offset)+";''><svg  height="+e.svgHeight+" width="+e.svgWidth+" style='fill:"+e.backgroundColor+" ; opacity: "+e.opacity+"; stroke-linejoin:round; stroke-linecap:round; fill-rule: evenodd' xmlns='http://www.w3.org/2000/svg'>",i="</svg></div>";return n+t.join("")+i},createSvgData:function(t,e){var n=[],i=t.getProjectedTopRight(),o=t.getProjectedBottomLeft();s.PolygonUtil.scale(i,e.scale),s.PolygonUtil.scale(o,e.scale),o.x>e.bounds.max.x||i.x<e.bounds.min.x||i.y>e.bounds.max.y||o.y<e.bounds.min.y||s.SvgUtil.buildSVGPolygon(n,t.outerProjectedBoundary,e);for(var a=0;a<t.innerProjectedBoundaries.length;a++){var i=t.innerProjectedBoundaries[a].getProjectedTopRight(),o=t.innerProjectedBoundaries[a].getProjectedBottomLeft();s.PolygonUtil.scale(i,e.scale),s.PolygonUtil.scale(o,e.scale),o.x>e.bounds.max.x||i.x<e.bounds.min.x||i.y>e.bounds.max.y||o.y<e.bounds.min.y||s.SvgUtil.buildSVGPolygon(n,t.innerProjectedBoundaries[a].points,e)}return n},buildSVGPolygon:function(t,e,n){for(var i,o,a,r,l,p,d=0,u=[[n.bounds.min.x,n.bounds.min.y],[n.bounds.max.x,n.bounds.min.y],[n.bounds.max.x,n.bounds.max.y],[n.bounds.min.x,n.bounds.max.y]],h=[],c=0;c<e.length;c++)i=e[c],o=new L.Point(i.x,i.y),s.PolygonUtil.scale(o,n.scale),s.PolygonUtil.roundPoint(o),p=c>0?s.PolygonUtil.getEuclidianDistance(r,o):n.tolerance,p>=n.tolerance&&(l=!1,d>2&&(l=s.PolygonUtil.isCollinear(a,r,o)),l?(h[h.length-1][0]=o.x,h[h.length-1][1]=o.y):(h.push([o.x,o.y]),a=r,r=o,d++));for(var g,f=s.PolygonUtil.clip(h,u),c=0;c<f.length;c++)o=new L.Point(f[c][0],f[c][1]),s.PolygonUtil.subtract(o,n.pixelOrigin.x+n.offset.x,n.pixelOrigin.y+n.offset.y),t.push(c>0?s.PolygonUtil.buildPath(o,"L"):s.PolygonUtil.buildPath(o,"M")),g=o;return t.length>0&&t.push(["z"]),t}},s.Util={getTimeInSeconds:function(){var t=new Date;return 3600*t.getHours()+60*t.getMinutes()+t.getSeconds()},getHoursAndMinutesInSeconds:function(){var t=new Date;return 3600*t.getHours()+60*t.getMinutes()},getCurrentDate:function(){var t=new Date,e=t.getFullYear(),n=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,i=t.getDate()<10?"0"+t.getDate():t.getDate();return e+""+n+i},getTimeFormat:function(t){var e=s.config.i18n;return"en"==e.language&&t>=43200?"p.m.":e.get("timeFormat")},secondsToHoursAndMinutes:function(t){var e=(t/60).toFixed(0),n=Math.floor(e/60);e-=60*n;var i="";return 0!=n&&(i+=n+"h "),i+=e+"min"},secondsToTimeOfDay:function(t){var e=Math.floor(t/3600),n=Math.floor(t/60)-60*e;return t=t-3600*e-60*n,e+":"+("0"+n).slice(-2)+":"+("0"+t).slice(-2)},generateId:function(t){var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return _.each(_.range(t?t:10),function(){e+=n.charAt(Math.floor(Math.random()*n.length))}),e},parseLatLonArray:function(t){for(var e=new Array,n=0;n<t.length;n++)e.push(new L.Point(t[n][0],t[n][1]));return e},routeToLeafletPolylines:function(t,e){e="undefined"!=typeof e?e:{};var n=[];return _.each(t.getSegments(),function(i,o){if("TRANSFER"!=i.getType()){var s={};s.color=_.has(e,"color")?e.color:i.getColor();var a={};a.weight=7,a.color="white",(0==o||o==t.getLength()-1)&&(s.dashArray="1, 8");var r=L.polyline(i.getPoints(),a),l=L.polyline(i.getPoints(),s);n.push([r,l])}}),n},getAddressByCoordinates:function(t,e,n){$.getJSON(s.config.nominatimUrl+"reverse.php?&format=json&lat="+t.lat+"&accept-language="+e+"&lon="+t.lng+"&json_callback=?",n)},formatReverseGeocoding:function(t){var e=[];_.has(t.address,"road")&&e.push(t.address.road),_.has(t.address,"house_number")&&e.push(t.address.house_number);var n=[];_.has(t.address,"postcode")&&n.push(t.address.postcode),_.has(t.address,"city")&&n.push(t.address.city);var i=[];return e.length>0&&i.push(e.join(" ")),n.length>0&&i.push(n.join(", ")),0==e.length&&0==n.length&&i.push(t.display_name),i.join(", ")},parsePolygons:function(t){if(t.error)return errorMessage;if(s.config.logging)var e=(new Date).getTime();var n=[];return _.each(t,function(t){var e={id:t.id,polygons:[]};_.each(t.polygons,function(t){var n=s.polygon(t.travelTime,t.area,s.Util.parseLatLonArray(t.outerBoundary)),i=_.findWhere(s.config.defaultTravelTimeControlOptions.travelTimes,{time:n.getTravelTime()});n.setColor(_.isUndefined(i)?"#000000":i.color);var o=_.findWhere(s.config.defaultTravelTimeControlOptions.travelTimes,{time:n.getTravelTime()});n.setOpacity(_.isUndefined(o)?1:o.opacity),_.each(t.innerBoundary,function(t){n.addInnerBoundary(s.Util.parseLatLonArray(t))}),e.polygons.push(n)}),n.push(e)}),s.config.logging&&console.log("Polygon parsing took: "+((new Date).getTime()-e)+"ms"),n},parseRoutes:function(t){for(var e=new Array,n=0;n<t.routes.length;n++)e.push(s.route(t.routes[n].travelTime,t.routes[n].segments));return e},getMarker:function(t,e){var n=_.has(e,"color")?"-"+e.color:"-blue";return e.icon=L.icon({iconSize:[25,41],iconUrl:e.iconPath+"marker-icon"+n+".png",iconAnchor:[12,41],shadowSize:[41,41],shadowUrl:e.iconPath+"marker-shadow.png",shadowAnchor:[41/3,41],popupAnchor:[0,-35]}),L.marker(t,e)},webMercatorToLeaflet:function(t){return t.x/=6378137,t.y/=6378137,L.CRS.EPSG3857.transformation._transform(t),t},webMercatorToLatLng:function(t,e){var n=L.CRS.EPSG3857.projection.unproject(new L.Point(t.x/=6378137,t.y/=6378137));return"undefined"!=typeof e?L.latLng([n.lat,n.lng,e]):n},latLngToWebMercator:function(t){var e=L.Projection.SphericalMercator.project(t);return e.x*=6378137,e.y*=6378137,e},getUserAgent:function(){var t,e=navigator.userAgent,n=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?(t=/\brv[ :]+(\d+)/g.exec(e)||[],"IE "+(t[1]||"")):"Chrome"===n[1]&&(t=e.match(/\bOPR\/(\d+)/),null!=t)?"Opera "+t[1]:(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(t=e.match(/version\/(\d+)/i))&&n.splice(1,1,t[1]),n.join(" "))},isAnimated:function(){var t=getUserAgent();return-1!=t.indexOf("IE")?!1:-1!=t.indexOf("Safari")?!1:-1!=t.indexOf("Firefox")?!1:s.config.defaultPolygonLayerOptions.animate?!0:!1},getTranslation:function(t){var e=s.Util.getUserAgent();return-1!=e.indexOf("IE 9")?"transform:translate("+t.x+"px,"+t.y+"px)":-1!=e.indexOf("Safari")?"-webkit-transform:translate3d("+t.x+"px,"+t.y+"px,0px)":-1!=e.indexOf("Firefox")?"-moz-transform:translate3d("+t.x+"px,"+t.y+"px,0px)":"transform:translate3d("+t.x+"px,"+t.y+"px,0px)"},googleLatlngToPoint:function(t,e,n){var i=t.getProjection().fromLatLngToPoint(e),o=Math.pow(2,n);return new google.maps.Point(i.x*o,i.y*o)},googlePointToLatlng:function(t,e,n){var i=Math.pow(2,n),o=new google.maps.Point(e.x/i,e.y/i),s=t.getProjection().fromPointToLatLng(o);return s}},s.DomUtil={setPosition:function(t,e){t._leaflet_pos=e,L.Browser.any3d?s.DomUtil.setTransform(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")},setTransform:function(t,e,n){var i=e||new L.Point(0,0);t.style[s.DomUtil.TRANSFORM]="translate3d("+i.x+"px,"+i.y+"px,0)"+(n?" scale("+n+")":"")},testProp:function(t){for(var n=e.documentElement.style,i=0;i<t.length;i++)if(t[i]in n)return t[i];return!1}},function(){s.DomUtil.TRANSFORM=s.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"])}(),s.TravelOptions=function(){this.sources=[],this.targets=[],this.service,this.bikeSpeed=n,this.bikeUphill=n,this.bikeDownhill=n,this.walkSpeed=n,this.walkUphill=n,this.walkDownhill=n,this.supportWatts=n,this.renderWatts=n,this.travelTimes=n,this.travelType=n,this.elevationEnabled=n,this.minPolygonHoleSize=n,this.time=n,this.date=n,this.recommendations=n,this.errors=[],this.intersectionMode=n,this.pathSerializer=s.config.pathSerializer,this.maxRoutingTime=n,this.waitControl,this.isValidPolygonServiceOptions=function(t){return this.errors=[],"[object Array]"===Object.prototype.toString.call(this.getSources())?0==this.getSources().length?this.getErrors().push("Sources do not contain any points!"):_.each(this.getSources(),function(t){_.has(t,"lat")||"function"==typeof t.getLatLng||this.getErrors().push("Sources contains source with undefined latitude!"),_.has(t,"lon")||_.has(t,"lng")||"function"==typeof t.getLatLng||this.getErrors().push("Sources contains source with undefined longitude!")}):this.getErrors().push("Sources are not of type array!"),_.contains(["bike","transit","walk","car","rentbike","rentandreturnbike","ebike"],this.getTravelType())?"car"==this.getTravelType()||("bike"==this.getTravelType()||"rentbike"==this.getTravelType()||"rentandreturnbike"==this.getTravelType()?(""!=typeof this.getBikeUphill()&&""!=typeof this.getBikeDownhill()&&"undefined"!=typeof this.getBikeUphill()&&(this.getBikeUphill()<0||this.getBikeDownhill()>0||this.getBikeUphill()<-this.getBikeDownhill())&&this.getErrors().push("Uphill cycle speed has to be larger then 0. Downhill cycle speed has to be smaller then 0.                             Absolute value of downhill cycle speed needs to be smaller then uphill cycle speed."),this.getBikeSpeed()<=0&&this.getErrors().push("Bike speed needs to be larger then 0.")):"walk"==this.getTravelType()?(""!=typeof this.getBikeUphill()&&""!=typeof this.getBikeDownhill()&&"undefined"!=typeof this.getBikeUphill()&&(this.getWalkUphill()<0||this.getWalkDownhill()>0||this.getWalkUphill()<-this.getWalkDownhill())&&this.getErrors().push("Uphill walking speed has to be larger then 0. Downhill walking speed has to be smaller then 0.                             Absolute value of downhill walking speed needs to be smaller then uphill walking speed."),this.getWalkSpeed()<=0&&this.getErrors().push("Walk speed needs to be larger then 0.")):"transit"==this.getTravelType()):this.getErrors().push("Not supported travel type given: "+this.getTravelType()),t||("undefined"==typeof this.getTravelTimes()||"[object Array]"!==Object.prototype.toString.call(this.getTravelTimes())?this.getErrors().push("Travel times have to be an array!"):_.reject(this.getTravelTimes(),function(t){return"number"==typeof t}).length>0&&this.getErrors().push("Travel times contain non number entries: "+this.getTravelTimes())),0==this.errors.length},this.isValidRouteServiceOptions=function(){return this.isValidPolygonServiceOptions(!0),"[object Array]"===Object.prototype.toString.call(this.getTargets())?0==this.getTargets().length?this.getErrors().push("Sources do not contain any points!"):_.each(this.getTargets(),function(t){_.has(t,"lat")||"function"==typeof t.getLatLng||this.getErrors().push("Targets contains target with undefined latitude!"),_.has(t,"lon")||_.has(t,"lng")||"function"==typeof t.getLatLng||this.getErrors().push("Targets contains target with undefined longitude!")}):this.getErrors().push("Targets are not of type array!"),_.contains(["travelTime","compact","detailed"],this.getPathSerializer())||this.getErrors().push("Path serializer not supported: "+this.getPathSerializer()),0==this.errors.length},this.isValidTimeServiceOptions=function(){return this.isValidRouteServiceOptions(),_.contains(["travelTime","compact","detailed"],this.getPathSerializer())||this.getErrors().push("Path serializer not supported: "+this.getPathSerializer()),0==this.errors.length},this.getErrors=function(){return this.errors},this.getSources=function(){return this.sources},this.addSource=function(t){this.sources.push(t)},this.addTarget=function(t){this.targets.push(t)},this.getTargets=function(){return this.targets},this.getBikeSpeed=function(){return this.bikeSpeed},this.getBikeUphill=function(){return this.bikeUphill},this.getBikeDownhill=function(){return this.bikeDownhill},this.getWalkSpeed=function(){return this.walkSpeed},this.getWalkUphill=function(){return this.walkUphill},this.getWalkDownhill=function(){return this.walkDownhill},this.getTravelTimes=function(){return this.travelTimes},this.getTravelType=function(){return this.travelType},this.getTime=function(){return this.time},this.getDate=function(){return this.date},this.getWaitControl=function(){return this.waitControl},this.getService=function(){return this.service},this.getPathSerializer=function(){return this.pathSerializer},this.getMaxRoutingTime=function(){return this.maxRoutingTime},this.getIntersectionMode=function(){return this.intersectionMode},this.getRecommendations=function(){return this.recommendations},this.setRecommendations=function(t){this.recommendations=t},this.setIntersectionMode=function(t){this.intersectionMode=t},this.setMaxRoutingTime=function(t){this.maxRoutingTime=t},this.setPathSerializer=function(t){this.pathSerializer=t},this.setService=function(t){this.service=t},this.setMinPolygonHoleSize=function(t){this.minPolygonHoleSize=t},this.getMinPolygonHoleSize=function(){return this.minPolygonHoleSize},this.setSources=function(t){this.sources=t},this.setTargets=function(t){this.targets=t},this.setBikeSpeed=function(t){this.bikeSpeed=t},this.setBikeUphill=function(t){this.bikeUphill=t},this.setBikeDownhill=function(t){this.bikeDownhill=t},this.setWalkSpeed=function(t){this.walkSpeed=t},this.setWalkUphill=function(t){this.walkUphill=t},this.setWalkDownhill=function(t){this.walkDownhill=t},this.setTravelTimes=function(t){this.travelTimes=t},this.setTravelType=function(t){this.travelType=t},this.setTime=function(t){this.time=t},this.setDate=function(t){this.date=t},this.setWaitControl=function(t){this.waitControl=t},this.isElevationEnabled=function(){return this.elevationEnabled},this.setElevationEnabled=function(t){this.elevationEnabled=t},this.setRenderWatts=function(t){this.renderWatts=t},this.getRenderWatts=function(){return this.renderWatts},this.setSupportWatts=function(t){this.supportWatts=t},this.getSupportWatts=function(){return this.supportWatts}},s.travelOptions=function(){return new s.TravelOptions},s.PolygonService={cache:{},getTravelTimePolygons:function(t,e,n){t.getWaitControl()&&(t.getWaitControl().show(),t.getWaitControl().updateText(s.config.i18n.getSpan("polygonWait")));var i={};i.sources=[],_.isUndefined(t.isElevationEnabled())||(i.elevation=t.isElevationEnabled()),_.isUndefined(t.getTravelTimes())&&_.isUndefined(t.getIntersectionMode())&&_.isUndefined(t.getRenderWatts())&&_.isUndefined(t.getSupportWatts())||(i.polygon={},_.isUndefined(t.getTravelTimes())||(i.polygon.values=t.getTravelTimes()),_.isUndefined(t.getIntersectionMode())||(i.polygon.intersectionMode=t.getIntersectionMode()),_.isUndefined(t.getRenderWatts())||(i.polygon.renderWatts=t.getRenderWatts()),_.isUndefined(t.getSupportWatts())||(i.polygon.supportWatts=t.getSupportWatts()),_.isUndefined(t.getMinPolygonHoleSize())||(i.polygon.minPolygonHoleSize=t.getMinPolygonHoleSize())),_.each(t.getSources(),function(e){var n={lat:_.has(e,"lat")?e.lat:e.getLatLng().lat,lng:_.has(e,"lon")?e.lon:_.has(e,"lng")?e.lng:e.getLatLng().lng,id:_.has(e,"id")?e.id:"",tm:{}},o=_.has(e,"travelType")?e.travelType:t.getTravelType();n.tm[o]={},("transit"==o||"biketransit"==o)&&(n.tm[o].frame={},_.isUndefined(t.getTime())||(n.tm[o].frame.time=t.getTime()),_.isUndefined(t.getDate())||(n.tm[o].frame.date=t.getDate())),"ebike"==o&&(n.tm.ebike={},_.isUndefined(t.getBikeSpeed())||(n.tm.ebike.speed=t.getBikeSpeed()),_.isUndefined(t.getBikeUphill())||(n.tm.ebike.uphill=t.getBikeUphill()),_.isUndefined(t.getBikeDownhill())||(n.tm.ebike.downhill=t.getBikeDownhill())),"rentbike"==o&&(n.tm.rentbike={},_.isUndefined(t.getBikeSpeed())||(n.tm.rentbike.bikespeed=t.getBikeSpeed()),_.isUndefined(t.getBikeUphill())||(n.tm.rentbike.bikeuphill=t.getBikeUphill()),_.isUndefined(t.getBikeDownhill())||(n.tm.rentbike.bikedownhill=t.getBikeDownhill()),_.isUndefined(t.getWalkSpeed())||(n.tm.rentbike.walkspeed=t.getWalkSpeed()),_.isUndefined(t.getWalkUphill())||(n.tm.rentbike.walkuphill=t.getWalkUphill()),_.isUndefined(t.getWalkDownhill())||(n.tm.rentbike.walkdownhill=t.getWalkDownhill())),"rentandreturnbike"==o&&(n.tm.rentandreturnbike={},_.isUndefined(t.getBikeSpeed())||(n.tm.rentandreturnbike.bikespeed=t.getBikeSpeed()),_.isUndefined(t.getBikeUphill())||(n.tm.rentandreturnbike.bikeuphill=t.getBikeUphill()),_.isUndefined(t.getBikeDownhill())||(n.tm.rentandreturnbike.bikedownhill=t.getBikeDownhill()),_.isUndefined(t.getWalkSpeed())||(n.tm.rentandreturnbike.walkspeed=t.getWalkSpeed()),_.isUndefined(t.getWalkUphill())||(n.tm.rentandreturnbike.walkuphill=t.getWalkUphill()),_.isUndefined(t.getWalkDownhill())||(n.tm.rentandreturnbike.walkdownhill=t.getWalkDownhill())),"bike"==o&&(n.tm.bike={},_.isUndefined(t.getBikeSpeed())||(n.tm.bike.speed=t.getBikeSpeed()),_.isUndefined(t.getBikeUphill())||(n.tm.bike.uphill=t.getBikeUphill()),_.isUndefined(t.getBikeDownhill())||(n.tm.bike.downhill=t.getBikeDownhill())),"walk"==o&&(n.tm.walk={},_.isUndefined(t.getWalkSpeed())||(n.tm.walk.speed=t.getWalkSpeed()),_.isUndefined(t.getWalkUphill())||(n.tm.walk.uphill=t.getWalkUphill()),_.isUndefined(t.getWalkDownhill())||(n.tm.walk.downhill=t.getWalkDownhill())),i.sources.push(n)}),_.has(s.PolygonService.cache,JSON.stringify(i))?(t.getWaitControl()&&t.getWaitControl().hide(),e(s.Util.parsePolygons(s.PolygonService.cache[JSON.stringify(i)]))):$.ajax({url:s.config.serviceUrl+s.config.serviceVersion+"/polygon?cfg="+encodeURIComponent(JSON.stringify(i))+"&cb=?&key="+s.config.serviceKey,timeout:s.config.requestTimeout,dataType:"json",success:function(o){t.getWaitControl()&&t.getWaitControl().hide(),_.has(o,"data")?"ok"==o.code?(s.PolygonService.cache[JSON.stringify(i)]=o.data,e(s.Util.parsePolygons(o.data))):_.isFunction(n)&&n(o.code,o.message):(s.PolygonService.cache[JSON.stringify(i)]=o,e(s.Util.parsePolygons(o)))},error:function(){t.getWaitControl()&&t.getWaitControl().hide(),_.isFunction(n)&&n("service-not-available","The travel time polygon service is currently not available, please try again later.")}})}},s.RouteService={cache:{},getRoutes:function(t,e,n){t.getWaitControl()&&(t.getWaitControl().show(),t.getWaitControl().updateText(s.config.i18n.getSpan("routeWait")));var i={sources:[],targets:[],pathSerializer:t.getPathSerializer(),elevation:t.isElevationEnabled()};_.each(t.getSources(),function(e){var n={lat:_.has(e,"lat")?e.lat:e.getLatLng().lat,lng:_.has(e,"lon")?e.lon:_.has(e,"lng")?e.lng:e.getLatLng().lng,id:_.has(e,"id")?e.id:"",tm:{}},o=_.has(e,"travelType")?e.travelType:t.getTravelType();n.tm[o]={},("transit"==o||"biketransit"==o)&&(n.tm[o].frame={},_.isUndefined(t.getTime())||(n.tm[o].frame.time=t.getTime()),_.isUndefined(t.getDate())||(n.tm[o].frame.date=t.getDate())),"ebike"==o&&(n.tm.ebike={},_.isUndefined(t.getBikeSpeed())||(n.tm.ebike.speed=t.getBikeSpeed()),_.isUndefined(t.getBikeUphill())||(n.tm.ebike.uphill=t.getBikeUphill()),_.isUndefined(t.getBikeDownhill())||(n.tm.ebike.downhill=t.getBikeDownhill())),"rentbike"==o&&(n.tm.rentbike={},_.isUndefined(t.getBikeSpeed())||(n.tm.rentbike.bikespeed=t.getBikeSpeed()),_.isUndefined(t.getBikeUphill())||(n.tm.rentbike.bikeuphill=t.getBikeUphill()),_.isUndefined(t.getBikeDownhill())||(n.tm.rentbike.bikedownhill=t.getBikeDownhill()),_.isUndefined(t.getWalkSpeed())||(n.tm.rentbike.walkspeed=t.getWalkSpeed()),_.isUndefined(t.getWalkUphill())||(n.tm.rentbike.walkuphill=t.getWalkUphill()),_.isUndefined(t.getWalkDownhill())||(n.tm.rentbike.walkdownhill=t.getWalkDownhill())),"rentandreturnbike"==o&&(n.tm.rentandreturnbike={},_.isUndefined(t.getBikeSpeed())||(n.tm.rentandreturnbike.bikespeed=t.getBikeSpeed()),_.isUndefined(t.getBikeUphill())||(n.tm.rentandreturnbike.bikeuphill=t.getBikeUphill()),_.isUndefined(t.getBikeDownhill())||(n.tm.rentandreturnbike.bikedownhill=t.getBikeDownhill()),_.isUndefined(t.getWalkSpeed())||(n.tm.rentandreturnbike.walkspeed=t.getWalkSpeed()),_.isUndefined(t.getWalkUphill())||(n.tm.rentandreturnbike.walkuphill=t.getWalkUphill()),_.isUndefined(t.getWalkDownhill())||(n.tm.rentandreturnbike.walkdownhill=t.getWalkDownhill())),"bike"==o&&(n.tm.bike={},_.isUndefined(t.getBikeSpeed())||(n.tm.bike.speed=t.getBikeSpeed()),_.isUndefined(t.getBikeUphill())||(n.tm.bike.uphill=t.getBikeUphill()),_.isUndefined(t.getBikeDownhill())||(n.tm.bike.downhill=t.getBikeDownhill())),"walk"==o&&(n.tm.walk={},_.isUndefined(t.getWalkSpeed())||(n.tm.walk.speed=t.getWalkSpeed()),_.isUndefined(t.getWalkUphill())||(n.tm.walk.uphill=t.getWalkUphill()),_.isUndefined(t.getWalkDownhill())||(n.tm.walk.downhill=t.getWalkDownhill())),i.sources.push(n)
}),i.targets=[],_.each(t.getTargets(),function(t){i.targets.push({lat:_.has(t,"lat")?t.lat:t.getLatLng().lat,lng:_.has(t,"lon")?t.lon:_.has(t,"lng")?t.lng:t.getLatLng().lng,id:_.has(t,"id")?t.id:""})}),_.has(s.RouteService.cache,JSON.stringify(i))?(t.getWaitControl()&&t.getWaitControl().hide(),e(s.Util.parseRoutes(JSON.parse(JSON.stringify(s.RouteService.cache[JSON.stringify(i)]))))):$.ajax({url:s.config.serviceUrl+s.config.serviceVersion+"/route?cfg="+encodeURIComponent(JSON.stringify(i))+"&cb=?&key="+s.config.serviceKey,timeout:s.config.requestTimeout,dataType:"json",success:function(o){t.getWaitControl()&&t.getWaitControl().hide(),_.has(o,"data")?"ok"==o.code?(s.RouteService.cache[JSON.stringify(i)]=JSON.parse(JSON.stringify(o.data)),e(s.Util.parseRoutes(o.data))):_.isFunction(n)&&n(o.code,o.message):(s.RouteService.cache[JSON.stringify(i)]=JSON.parse(JSON.stringify(o)),e(s.Util.parseRoutes(o)))},error:function(){t.getWaitControl()&&t.getWaitControl().hide(),_.isFunction(n)&&n("service-not-available","The routing service is currently not available, please try again later.")}})}},s.TimeService={cache:{},getRouteTime:function(t,e,n){t.getWaitControl()&&(t.getWaitControl().show(),t.getWaitControl().updateText(s.config.i18n.getSpan("timeWait")));var i={sources:[],targets:[],pathSerializer:t.getPathSerializer(),maxRoutingTime:t.getMaxRoutingTime()};_.isUndefined(t.isElevationEnabled())||(i.elevation=t.isElevationEnabled()),_.isUndefined(t.getTravelTimes())&&_.isUndefined(t.getIntersectionMode())&&_.isUndefined(t.getRenderWatts())&&_.isUndefined(t.getSupportWatts())||(i.polygon={},_.isUndefined(t.getTravelTimes())||(i.polygon.values=t.getTravelTimes()),_.isUndefined(t.getIntersectionMode())||(i.polygon.intersectionMode=t.getIntersectionMode()),_.isUndefined(t.getRenderWatts())||(i.polygon.renderWatts=t.getRenderWatts()),_.isUndefined(t.getSupportWatts())||(i.polygon.supportWatts=t.getSupportWatts()),_.isUndefined(t.getMinPolygonHoleSize())||(i.polygon.minPolygonHoleSize=t.getMinPolygonHoleSize())),_.each(t.getSources(),function(e){var n={lat:_.has(e,"lat")?e.lat:e.getLatLng().lat,lng:_.has(e,"lon")?e.lon:_.has(e,"lng")?e.lng:e.getLatLng().lng,id:_.has(e,"id")?e.id:"",tm:{}},o=_.has(e,"travelType")?e.travelType:t.getTravelType();n.tm[o]={},("transit"==o||"biketransit"==o)&&(n.tm[o].frame={},_.isUndefined(t.getTime())||(n.tm[o].frame.time=t.getTime()),_.isUndefined(t.getDate())||(n.tm[o].frame.date=t.getDate())),"ebike"==o&&(n.tm.ebike={},_.isUndefined(t.getBikeSpeed())||(n.tm.ebike.speed=t.getBikeSpeed()),_.isUndefined(t.getBikeUphill())||(n.tm.ebike.uphill=t.getBikeUphill()),_.isUndefined(t.getBikeDownhill())||(n.tm.ebike.downhill=t.getBikeDownhill())),"rentbike"==o&&(n.tm.rentbike={},_.isUndefined(t.getBikeSpeed())||(n.tm.rentbike.bikespeed=t.getBikeSpeed()),_.isUndefined(t.getBikeUphill())||(n.tm.rentbike.bikeuphill=t.getBikeUphill()),_.isUndefined(t.getBikeDownhill())||(n.tm.rentbike.bikedownhill=t.getBikeDownhill()),_.isUndefined(t.getWalkSpeed())||(n.tm.rentbike.walkspeed=t.getWalkSpeed()),_.isUndefined(t.getWalkUphill())||(n.tm.rentbike.walkuphill=t.getWalkUphill()),_.isUndefined(t.getWalkDownhill())||(n.tm.rentbike.walkdownhill=t.getWalkDownhill())),"rentandreturnbike"==o&&(n.tm.rentandreturnbike={},_.isUndefined(t.getBikeSpeed())||(n.tm.rentandreturnbike.bikespeed=t.getBikeSpeed()),_.isUndefined(t.getBikeUphill())||(n.tm.rentandreturnbike.bikeuphill=t.getBikeUphill()),_.isUndefined(t.getBikeDownhill())||(n.tm.rentandreturnbike.bikedownhill=t.getBikeDownhill()),_.isUndefined(t.getWalkSpeed())||(n.tm.rentandreturnbike.walkspeed=t.getWalkSpeed()),_.isUndefined(t.getWalkUphill())||(n.tm.rentandreturnbike.walkuphill=t.getWalkUphill()),_.isUndefined(t.getWalkDownhill())||(n.tm.rentandreturnbike.walkdownhill=t.getWalkDownhill())),"bike"==o&&(n.tm.bike={},_.isUndefined(t.getBikeSpeed())||(n.tm.bike.speed=t.getBikeSpeed()),_.isUndefined(t.getBikeUphill())||(n.tm.bike.uphill=t.getBikeUphill()),_.isUndefined(t.getBikeDownhill())||(n.tm.bike.downhill=t.getBikeDownhill())),"walk"==o&&(n.tm.walk={},_.isUndefined(t.getWalkSpeed())||(n.tm.walk.speed=t.getWalkSpeed()),_.isUndefined(t.getWalkUphill())||(n.tm.walk.uphill=t.getWalkUphill()),_.isUndefined(t.getWalkDownhill())||(n.tm.walk.downhill=t.getWalkDownhill())),i.sources.push(n)}),_.each(t.getTargets(),function(t){i.targets.push({lat:_.has(t,"lat")?t.lat:t.getLatLng().lat,lng:_.has(t,"lon")?t.lon:_.has(t,"lng")?t.lng:t.getLatLng().lng,id:_.has(t,"id")?t.id:""})}),_.has(s.TimeService.cache,JSON.stringify(i))?(t.getWaitControl()&&t.getWaitControl().hide(),e(s.TimeService.cache[JSON.stringify(i)])):$.ajax({url:s.config.serviceUrl+s.config.serviceVersion+"/time?key="+s.config.serviceKey,type:"POST",data:JSON.stringify(i),contentType:"application/json",timeout:s.config.requestTimeout,dataType:"json",success:function(o){t.getWaitControl()&&t.getWaitControl().hide(),_.has(o,"data")?"ok"==o.code?(s.TimeService.cache[JSON.stringify(i)]=o.data,e(o.data)):_.isFunction(n)&&n(o.code,o.message):(s.TimeService.cache[JSON.stringify(i)]=o,e(o))},error:function(){t.getWaitControl()&&t.getWaitControl().hide(),_.isFunction(n)&&n("service-not-available","The time service is currently not available, please try again later.")}})}},s.OsmService={cache:{},getPoisInBoundingBox:function(t,e,n,i,o){n&&(n.show(),n.updateText(s.config.i18n.getSpan("osmWait")));var a=$.param({tags:e},!0);"undefined"!=typeof t&&(a.northEast=t._northEast.lng+"|"+t._northEast.lat,a.southWest=t._southWest.lng+"|"+t._southWest.lat),_.has(s.OsmService.cache,a)?(n&&n.hide(),i(s.OsmService.cache[a])):$.ajax({url:s.config.osmServiceUrl+"pois/search?callback=?&"+a,timeout:s.config.requestTimeout,dataType:"json",success:function(t){n&&n.hide(),i(t)},error:function(){n&&n.hide(),_.isFunction(o)&&o("service-not-available","The travel time polygon service is currently not available, please try again later.")}})}},s.photonPlaceAutoCompleteControl=function(t){return new s.PhotonPlaceAutoCompleteControl(t)},s.PhotonPlaceAutoCompleteControl=L.Control.extend({initialize:function(t){this.options=JSON.parse(JSON.stringify(s.config.photonPlaceAutoCompleteOptions)),"undefined"!=typeof t&&(_.has(t,"position")&&(this.options.position=t.position),_.has(t,"label")&&(this.options.label=t.label),_.has(t,"country")&&(this.options.country=t.country),_.has(t,"reset")&&(this.options.reset=t.reset),_.has(t,"reverse")&&(this.options.reverse=t.reverse),_.has(t,"placeholder")&&(this.options.placeholder=t.placeholder),_.has(t,"width")&&(this.options.width=t.width),_.has(t,"maxRows")&&(this.options.maxRows=t.maxRows),_.has(t,"image")&&(this.options.image=t.image),_.has(t,"index")&&(this.options.index=t.index),_.has(t,"options")&&(this.options.options=t.options,this.options.travelType=_.has(this.options.options,"init")?this.options.options.init:"walk"))},onAdd:function(t){var e=this,n=s.config.i18n,i="",o=L.DomUtil.create("div",e._container);e.options.map=t,e.options.id=$(t._container).attr("id")+s.Util.generateId(10),t.on("resize",e.onResize.bind(e));var a=e.options.width,r='style="width:'+a+'px;"';e.options.input='<div class="input-group autocomplete" '+r+'>                 <input id="autocomplete-'+e.options.id+'" style="color: black;width:'+a+'"                 type="text" class="form-control r360-autocomplete" placeholder="'+e.options.placeholder+'" onclick="this.select()">',e.options.image&&(e.options.input+='<span id="'+e.options.id+'-image" class="input-group-addon btn-autocomplete-marker">                     <img style="height:22px;" src="'+e.options.image+'">                  </span>');var l=[];return e.options.input+='<span id="'+e.options.id+'-options-button" class="input-group-btn travel-type-buttons" '+(e.options.options?"":'style="display: none;"')+'>                     <button class="btn btn-autocomplete" type="button" title="'+n.get("settings")+'"><i class="fa fa-cog fa-fw"></i></button>                 </span>',l.push('<div id="'+e.options.id+'-options" class="text-center" style="color: black;width:'+a+'; display: none;">'),l.push('  <div class="btn-group text-center">'),e.options.options&&e.options.options.walk&&l.push('<button type="button" class="btn btn-default travel-type-button '+("walk"==this.options.travelType?"active":"")+'" travel-type="walk"><span class="map-icon-walking travel-type-icon"></span> <span lang="en">Walk</span><span lang="de">zu Fuß</span></button>'),e.options.options&&e.options.options.bike&&l.push('<button type="button" class="btn btn-default travel-type-button '+("bike"==this.options.travelType?"active":"")+'" travel-type="bike"><span class="map-icon-bicycling travel-type-icon"></span> <span lang="en">Bike</span><span lang="de">Fahrrad</span></button>'),e.options.options&&e.options.options.hirebike&&l.push('<button type="button" class="btn btn-default travel-type-button '+("hirebike"==this.options.travelType?"active":"")+'" travel-type="hirebike">                             <span class="map-icon-bicycling travel-type-icon"></span> <span lang="en">Hire Bike</span><span lang="de">Leihfahrrad</span>                        </button>'),e.options.options&&e.options.options.transit&&l.push('<button type="button" class="btn btn-default travel-type-button '+("transit"==this.options.travelType?"active":"")+'" travel-type="transit"><span class="map-icon-train-station travel-type-icon"></span> <span lang="en">Transit</span><span lang="de">ÖPNV</span></button>'),e.options.options&&e.options.options.car&&l.push('<button type="button" class="btn btn-default travel-type-button '+("car"==this.options.travelType?"active":"")+'" travel-type="car"><span class="fa fa-car"></span> <span lang="en">Car</span><span lang="de">Auto</span></button>'),l.push("  </div>"),l.push("</div>"),e.options.input+='<span id="'+e.options.id+'-reverse" '+(e.options.reverse?"":'style="display: none;"')+'" class="input-group-btn">                     <button class="btn btn-autocomplete" type="button" title="'+n.get("reverse")+'"><i class="fa fa-arrows-v fa-fw"></i></button>                 </span>',e.options.input+='<span id="'+e.options.id+'-reset" '+(e.options.reset?"":'style="display: none;"')+'" class="input-group-btn">                     <button class="btn btn-autocomplete" type="button" title="'+n.get("reset")+'"><i class="fa fa-times fa-fw"></i></button>                 </span>',e.options.input+="</div>",e.options.options&&(e.options.input+=l.join("")),$(o).append(e.options.input),$(o).find("#"+e.options.id+"-reset").click(function(){e.options.onReset()}),$(o).find("#"+e.options.id+"-reverse").click(function(){e.options.onReverse()}),$(o).find("#"+e.options.id+"-options-button").click(function(){$("#"+e.options.id+"-options").slideToggle()}),$(o).find(".travel-type-button").click(function(){$(o).find(".travel-type-button").removeClass("active"),$(this).addClass("active"),setTimeout(function(){$("#"+e.options.id+"-options").slideToggle()},300),e.options.travelType=$(this).attr("travel-type"),e.options.onTravelTypeChange()}),L.DomEvent.disableClickPropagation(o),_.has(e.options,"country")&&(i+=" AND country:"+e.options.country),$(o).find("#autocomplete-"+e.options.id).autocomplete({source:function(t,n){e.source=this;for(var i=t.term.split(" "),o=new Array,s="",a="",r=0;r<i.length;r++)-1!=i[r].search(".*[0-9].*")?o.push(i[r]):s+=i[r]+" ";if(o.length>0){a+=" OR ";for(var l=0;l<o.length;l++){var p="(postcode : "+o[l]+" OR housenumber : "+o[l]+" OR street : "+o[l]+") ";a+=p}}console.log(e.options.map.getCenter()),$.ajax({url:e.options.serviceUrl,async:!1,data:{q:s,limit:e.options.maxRows},success:function(i){var o=new Array;n($.map(i.features,function(n){if("boundary"!=n.osm_key){var i={},s=[],a=[];if(i.name=n.properties.name,i.city=n.properties.city,i.street=n.properties.street,i.housenumber=n.properties.housenumber,i.country=n.properties.country,i.postalCode=n.properties.postcode,i.name&&s.push(i.name),i.city&&s.push(i.city),i.street&&a.push(i.street),i.housenumber&&a.push(i.housenumber),i.postalCode&&a.push(i.postalCode),i.city&&a.push(i.city),a.push(i.country),!_.contains(o,s.join()+a.join()))return o.push(s.join()+a.join()),{label:s.join(", "),value:s.join(", "),firstRow:s.join(", "),secondRow:a.join(" "),term:t.term,index:e.options.index,latlng:new L.LatLng(n.geometry.coordinates[1],n.geometry.coordinates[0])}}}))}})},minLength:2,select:function(t,n){e.options.value=n.item,e.options.onSelect(n.item)}}).data("ui-autocomplete")._renderItem=function(t,e){function n(t){return t.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}var i=e.term?e.firstRow.replace(new RegExp(n(e.term),"gi"),"<strong>$&</strong>"):e.firstRow,o=e.term?e.secondRow.replace(new RegExp(n(e.term),"gi"),"<strong>$&</strong>"):e.secondRow,s="<a><span class='address-row1'>"+i+"</span><br/><span class='address-row2'>  "+o+"</span></a>";return $("<li>").append(s).appendTo(t)},this.onResize(),o},onSelect:function(t){this.options.onSelect=t},onReset:function(t){this.options.onReset=t},onReverse:function(t){this.options.onReverse=t},onTravelTypeChange:function(t){this.options.onTravelTypeChange=t},reset:function(){this.options.value={},this.setFieldValue("")},update:function(t,e){this.setLatLng(t),this.setFieldValue(e)},setLatLng:function(t){this.options.value.latlng=t},setFieldValue:function(t){var e=this;$("#autocomplete-"+e.options.id).val(t)},getFieldValue:function(){var t=this;return $("#autocomplete-"+t.options.id).val()},getTravelType:function(){return this.options.travelType},setValue:function(t){this.options.value=t},getValue:function(){return this.options.value},getIndex:function(){return this.options.index},onResize:function(){var t=this;$(t.options.input).css(this.options.map.getSize().x<550?{width:"45px"}:{width:""})}}),s.placeAutoCompleteControl=function(t){return new s.PlaceAutoCompleteControl(t)},s.PlaceAutoCompleteControl=L.Control.extend({initialize:function(t){this.options=JSON.parse(JSON.stringify(s.config.defaultPlaceAutoCompleteOptions)),"undefined"!=typeof t&&(_.has(t,"position")&&(this.options.position=t.position),_.has(t,"label")&&(this.options.label=t.label),_.has(t,"country")&&(this.options.country=t.country),_.has(t,"reset")&&(this.options.reset=t.reset),_.has(t,"reverse")&&(this.options.reverse=t.reverse),_.has(t,"placeholder")&&(this.options.placeholder=t.placeholder),_.has(t,"width")&&(this.options.width=t.width),_.has(t,"maxRows")&&(this.options.maxRows=t.maxRows),_.has(t,"showOnStartup")&&(this.options.showOnStartup=t.showOnStartup),_.has(t,"image")&&(this.options.image=t.image),_.has(t,"index")&&(this.options.index=t.index),_.has(t,"autoHide")&&(this.options.autoHide=t.autoHide),_.has(t,"options")&&(this.options.options=t.options,this.options.travelType=_.has(this.options.options,"init")?this.options.options.init:"walk"))},toggleOptions:function(t){var e=this;"undefined"==typeof t?$("#"+e.options.id+"-options").slideToggle():$(t).find("#"+e.options.id+"-options").slideToggle()},onAdd:function(t){var e=this,n=s.config.i18n,i="",o=L.DomUtil.create("div",e._container);e.options.map=t,e.options.id=$(t._container).attr("id")+s.Util.generateId(10),t.on("resize",e.onResize.bind(e));var a=e.options.width,r='style="width:'+a+'px;"';e.options.input='<div class="input-group autocomplete r360-box-shadow" '+r+'>                 <input id="autocomplete-'+e.options.id+'" style="color: black;widthe:'+a+'"                 type="text" class="form-control r360-autocomplete" placeholder="'+e.options.placeholder+'" onclick="this.select()">',e.options.image&&(e.options.input+='<span id="'+e.options.id+'-image" class="input-group-addon btn-autocomplete-marker">                     <img style="height:22px;" src="'+e.options.image+'">                  </span>');var l=[];return e.options.input+='<span id="'+e.options.id+'-options-button" class="input-group-btn travel-type-buttons" '+(e.options.options?"":'style="display: none;"')+'>                     <button id="'+e.options.id+'-options-btn" class="btn btn-autocomplete" type="button" title="'+n.get("settings")+'"><i class="fa fa-cog fa-fw"></i></button>                 </span>',l.push('<div id="'+e.options.id+'-options" class="text-center r360-box-shadoww" style="color: black;widtth:'+a+"; display: "+(this.options.showOnStartup?"block":"none")+';">'),l.push('  <div class="btn-group text-center">'),e.options.options&&e.options.options.walk&&l.push('<button type="button" class="btn btn-default travel-type-button '+("walk"==this.options.travelType?"active":"")+'" travel-type="walk"><span class="fa fa-male travel-type-icon"></span> <span lang="en">Walk</span><span lang="no">Gå</span><span lang="de">zu Fuß</span></button>'),e.options.options&&e.options.options.bike&&l.push('<button type="button" class="btn btn-default travel-type-button '+("bike"==this.options.travelType?"active":"")+'" travel-type="bike"><span class="fa fa-bicycle travel-type-icon"></span> <span lang="en">Bike</span><span lang="no">Sykle</span><span lang="de">Fahrrad</span></button>'),e.options.options&&e.options.options.rentbike&&l.push('<button type="button" class="btn btn-default travel-type-button '+("rentbike"==this.options.travelType?"active":"")+'" travel-type="rentbike">                             <span class="fa fa-bicycle travel-type-icon"></span> <span lang="en">Hire Bike</span><span lang="no">Bysykkel</span><span lang="de">Leihfahrrad</span>                        </button>'),e.options.options&&e.options.options.rentandreturnbike&&l.push('<button type="button" class="btn btn-default travel-type-button '+("rentandreturnbike"==this.options.travelType?"active":"")+'" travel-type="rentandreturnbike">                             <span class="fa fa-bicycle travel-type-icon"></span> <span lang="en">Hire & Return Bike</span><span lang="no">Bysykkel</span><span lang="de">Leihfahrrad</span>                        </button>'),e.options.options&&e.options.options.ebike&&l.push('<button type="button" class="btn btn-default travel-type-button '+("ebike"==this.options.travelType?"active":"")+'" travel-type="ebike"><span class="fa fa-bicycle travel-type-icon"></span> <span lang="en">E-Bike</span><span lang="no">Elsykkel</span><span lang="de">E-Fahrrad</span></button>'),e.options.options&&e.options.options.transit&&l.push('<button type="button" class="btn btn-default travel-type-button '+("transit"==this.options.travelType?"active":"")+'" travel-type="transit"><span class="fa fa-bus travel-type-icon"></span> <span lang="en">Transit</span><span lang="no">TODO</span><span lang="de">ÖPNV</span></button>'),e.options.options&&e.options.options.car&&l.push('<button type="button" class="btn btn-default travel-type-button '+("car"==this.options.travelType?"active":"")+'" travel-type="car"><span class="fa fa-car"></span> <span lang="en">Car</span><span lang="no">TODO</span><span lang="de">Auto</span></button>'),l.push("  </div>"),l.push("</div>"),e.options.input+='<span id="'+e.options.id+'-reverse" '+(e.options.reverse?"":'style="display: none;"')+'" class="input-group-btn">                     <button id="'+e.options.id+'-reverse-button" class="btn btn-autocomplete" type="button" title="'+n.get("reverse")+'"><i class="fa fa-arrows-v fa-fw"></i></button>                 </span>',e.options.input+='<span id="'+e.options.id+'-reset" '+(e.options.reset?"":'style="display: none;"')+'" class="input-group-btn">                     <button id="'+e.options.id+'-reset-button" class="btn btn-autocomplete" type="button" title="'+n.get("reset")+'"><i class="fa fa-times fa-fw"></i></button>                 </span>',e.options.input+="</div>",e.options.options&&(e.options.input+=l.join("")),$(o).append(e.options.input),$(o).find("#"+e.options.id+"-reset").click(function(){e.options.onReset()}),$(o).find("#"+e.options.id+"-reverse").click(function(){e.options.onReverse()}),$(o).find("#"+e.options.id+"-options-button").click(function(){$("#"+e.options.id+"-options").slideToggle()}),$(o).find(".travel-type-button").click(function(){$(o).find(".travel-type-button").removeClass("active"),$(this).addClass("active"),e.options.autoHide&&setTimeout(function(){$("#"+e.options.id+"-options").slideToggle()},300),e.options.travelType=$(this).attr("travel-type"),e.options.onTravelTypeChange()}),L.DomEvent.disableClickPropagation(o),_.has(e.options,"country")&&(i+=" AND country:"+e.options.country),$(o).find("#autocomplete-"+e.options.id).autocomplete({source:function(t,n){e.source=this;for(var o=t.term.split(" "),s=new Array,a="",r="",l=0;l<o.length;l++)-1!=o[l].search(".*[0-9].*")?s.push(o[l]):a+=o[l]+" ";if(s.length>0){r+=" OR ";for(var p=0;p<s.length;p++){var d="(postcode : "+s[p]+" OR housenumber : "+s[p]+" OR street : "+s[p]+") ";r+=d}}$.ajax({url:e.options.serviceUrl,dataType:"jsonp",jsonp:"json.wrf",async:!1,data:{wt:"json",indent:!0,rows:e.options.maxRows,qt:"en",q:"("+a+r+")"+i},success:function(i){var o=new Array;n($.map(i.response.docs,function(n){if("boundary"!=n.osm_key){var i=n.coordinate.split(","),s={},a=[],r=[];if(s.name=n.name,s.city=n.city,s.street=n.street,s.housenumber=n.housenumber,s.country=n.country,s.postalCode=n.postcode,s.name&&a.push(s.name),s.city&&a.push(s.city),s.street&&r.push(s.street),s.housenumber&&r.push(s.housenumber),s.postalCode&&r.push(s.postalCode),s.city&&r.push(s.city),!_.has(e.options,"country")&&s.country&&r.push(s.country),!_.contains(o,a.join()+r.join()))return o.push(a.join()+r.join()),{label:a.join(", "),value:a.join(", "),firstRow:a.join(", "),secondRow:r.join(" "),term:t.term,index:e.options.index,latlng:new L.LatLng(i[0],i[1])}}}))}})},minLength:2,select:function(t,n){e.options.value=n.item,e.options.onSelect(n.item)}}).data("ui-autocomplete")._renderItem=function(t,e){function n(t){return t.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}var i=e.term?e.firstRow.replace(new RegExp(n(e.term),"gi"),"<strong>$&</strong>"):e.firstRow,o=e.term?e.secondRow.replace(new RegExp(n(e.term),"gi"),"<strong>$&</strong>"):e.secondRow,s="<a><span class='address-row1'>"+i+"</span><br/><span class='address-row2'>  "+o+"</span></a>";return $("<li>").append(s).appendTo(t)},this.onResize(),o},onSelect:function(t){this.options.onSelect=t},onReset:function(t){this.options.onReset=t},onReverse:function(t){this.options.onReverse=t},onTravelTypeChange:function(t){this.options.onTravelTypeChange=t},updateI18n:function(t){var e=this;$("#autocomplete-"+e.options.id).attr("placeholder",s.config.i18n.get(t?"placeholderSrc":"placeholderTrg")),$("#"+e.options.id+"-reverse-button").attr("title",s.config.i18n.get("reverse")),$("#"+e.options.id+"-reset-button").attr("title",s.config.i18n.get("reset")),$("#"+e.options.id+"-options-btn").attr("title",s.config.i18n.get("settings"))},reset:function(){this.options.value={},this.setFieldValue("")},update:function(t,e){this.setLatLng(t),this.setFieldValue(e)},setLatLng:function(t){this.options.value.latlng=t},setFieldValue:function(t){var e=this;$("#autocomplete-"+e.options.id).val(t)},getFieldValue:function(){var t=this;return $("#autocomplete-"+t.options.id).val()},getTravelType:function(){return this.options.travelType},setValue:function(t){this.options.value=t},getValue:function(){return this.options.value},getIndex:function(){return this.options.index},onResize:function(){var t=this;$(t.options.input).css(this.options.map.getSize().x<550?{width:"45px"}:{width:""})}}),s.TravelStartDateControl=L.Control.extend({options:{position:"topright",dateFormat:"yy-mm-dd",minDate:0},initialize:function(t){L.Util.setOptions(this,t)},onChange:function(t){this.options.onChange=t},onAdd:function(t){var e=this;e.options.map=t;var n=L.DomUtil.create("div","startDatePicker",this._container);e.datepicker=$("<div/>"),$(n).append(e.datepicker);var i={onSelect:function(){e.options.onChange(e.getValue())},firstDay:1},o=s.config.i18n;return"en"!=o.language&&(i.monthNames=o.monthNames[o.language],i.dayNames=o.dayNames[o.language],i.dayNamesMin=o.dayNamesMin[o.language]),$(e.datepicker).datepicker(i),L.DomEvent.disableClickPropagation(n),n},getValue:function(){var t=this,e=$(t.datepicker).datepicker({dateFormat:"dd-mm-yy"}).val(),n=e.split("/"),i=n[2]+""+n[0]+n[1];return i}}),s.travelStartDateControl=function(){return new s.TravelStartDateControl},s.TravelStartTimeControl=L.Control.extend({options:{position:"topright",range:!1,min:0,max:86400,step:600,initValue:28800,value:0},initialize:function(t){this.options.value=s.Util.getHoursAndMinutesInSeconds(),L.Util.setOptions(this,t)},onSlideStop:function(t){this.options.slideStop=t},minToString:function(t){t/=60;var e=Math.floor(t/60),n=t-60*e;return e>24&&(e-=24),10>e&&(e="0"+e),10>n&&(n="0"+n),0==n&&(n="00"),e+":"+n},onAdd:function(t){var e=this;e.options.map=t,e.options.mapId=$(t._container).attr("id"),t.on("resize",this.onResize.bind(this));var n=L.DomUtil.create("div","startTimeSlider",this._container);return e.miBox=$("<div/>",{"class":"mi-box"}),e.startTimeInfo=$("<div/>"),e.label=$("<span/>"),e.slider=$("<div/>"),$(n).append(e.miBox.append(e.startTimeInfo.append(e.label)).append(e.slider)),$(e.label).text(s.config.i18n.get("departure")+": "+e.minToString(this.options.value)+" "+s.Util.getTimeFormat(e.options.value)),$(e.slider).slider({range:e.options.range,value:e.options.value,min:e.options.min,max:e.options.max,step:e.options.step,slide:function(t,n){$(e.label).text(s.config.i18n.get("departure")+": "+e.minToString(n.value)+" "+s.Util.getTimeFormat(n.value)),e.options.value=n.value},stop:function(t,n){e.options.slideStop(n.value)}}),this.onResize(),L.DomEvent.disableClickPropagation(n),n},onResize:function(){this.options.map.getSize().x<550?(this.removeAndAddClass(this.miBox,"leaflet-traveltime-slider-container-max","leaflet-traveltime-slider-container-min"),this.removeAndAddClass(this.startTimeInfo,"travel-time-info-max","travel-time-info-min"),this.removeAndAddClass(this.slider,"leaflet-traveltime-slider-max","leaflet-traveltime-slider-min")):(this.removeAndAddClass(this.miBox,"leaflet-traveltime-slider-container-min","leaflet-traveltime-slider-container-max"),this.removeAndAddClass(this.startTimeInfo,"travel-time-info-min","travel-time-info-max"),this.removeAndAddClass(this.slider,"leaflet-traveltime-slider-min","leaflet-traveltime-slider-max"))},removeAndAddClass:function(t,e,n){$(t).addClass(n),$(t).removeClass(e)},getValue:function(){return this.options.value}}),s.travelStartTimeControl=function(){return new s.TravelStartTimeControl},s.TravelTimeControl=L.Control.extend({initialize:function(t){this.options=JSON.parse(JSON.stringify(s.config.defaultTravelTimeControlOptions)),"undefined"!=typeof t&&(_.has(t,"position")&&(this.options.position=t.position),_.has(t,"unit")&&(this.options.unit=t.unit),_.has(t,"initValue")&&(this.options.initValue=t.initValue),_.has(t,"label")&&(this.options.label=t.label),_.has(t,"travelTimes")&&(this.options.travelTimes=t.travelTimes),_.has(t,"icon")&&(this.options.icon=t.icon)),this.options.maxValue=_.max(this.options.travelTimes,function(t){return t.time}).time/60,this.options.step=(this.options.travelTimes[1].time-this.options.travelTimes[0].time)/60},onAdd:function(t){var e=this;this.options.map=t,t.on("resize",this.onResize.bind(this));for(var n="",i=100/this.options.travelTimes.length,o=0;o<this.options.travelTimes.length;o++)0==o?n+='<div style="position: absolute; top: 0; bottom: 0; left: '+o*i+"%; right: "+(100-(o+1)*i)+"%; background-color: "+this.options.travelTimes[o].color+'; -moz-border-top-left-radius: 8px;-webkit-border-radius-topleft: 8px; border-top-left-radius: 8px; -moz-border-bottom-left-radius: 8px;-webkit-border-radius-bottomleft: 8px; border-bottom-left-radius: 8px;"></div>':o<this.options.travelTimes.length-1?n+='<div style="position: absolute; top: 0; bottom: 0; left: '+o*i+"%; right: "+(100-(o+1)*i)+"%; background-color: "+this.options.travelTimes[o].color+';"></div>':o==this.options.travelTimes.length-1&&(n+='<div style="position: absolute; top: 0; bottom: 0; left: '+o*i+"%; right: "+(100-(o+1)*i)+"%; background-color: "+this.options.travelTimes[o].color+'; -moz-border-top-right-radius: 8px;-webkit-border-radius-topright: 8px; border-top-right-radius: 8px; -moz-border-bottom-right-radius: 8px;-webkit-border-radius-bottomright: 8px; border-bottom-right-radius: 8px;"></div>');this.options.sliderContainer=L.DomUtil.create("div",this._container),this.options.miBox=$("<div/>",{"class":"mi-box"}),this.options.travelTimeInfo=$("<div/>"),this.options.travelTimeSlider=$("<div/>",{"class":"no-border"}).append(n);var s=$("<div/>",{"class":"ui-slider-handle"});this.options.labelSpan=this.options.label,console.log(this.options),_.has(this.options,"icon")&&"undefined"!==this.options.icon&&(this.options.iconHTML=$("<img/>",{src:this.options.icon})),this.options.travelTimeSpan=$("<span/>",{text:this.options.initValue});var a=$("<span/>",{text:this.options.unit});return $(this.options.sliderContainer).append(this.options.miBox),this.options.miBox.append(this.options.travelTimeInfo),this.options.miBox.append(this.options.travelTimeSlider),this.options.travelTimeSlider.append(s),this.options.travelTimeInfo.append(this.options.iconHTML).append(this.options.labelSpan).append(": ").append(this.options.travelTimeSpan).append(a),$(this.options.travelTimeSlider).slider({range:!1,value:e.options.initValue,min:0,max:e.options.maxValue,step:e.options.step,slide:function(t,n){return 0==n.value?!1:void $(e.options.travelTimeSpan).text(n.value)},stop:function(t,n){for(var i=new Array,o=0;o<n.value;o+=e.options.step)i.push(e.options.travelTimes[o/e.options.step]);e.options.onSlideStop(i)}}),this.onResize(),L.DomEvent.disableClickPropagation(this.options.sliderContainer),this.options.sliderContainer},onResize:function(){this.options.map.getSize().x<550?(this.removeAndAddClass(this.options.miBox,"leaflet-traveltime-slider-container-max","leaflet-traveltime-slider-container-min"),this.removeAndAddClass(this.options.travelTimeInfo,"travel-time-info-max","travel-time-info-min"),this.removeAndAddClass(this.options.travelTimeSlider,"leaflet-traveltime-slider-max","leaflet-traveltime-slider-min")):(this.removeAndAddClass(this.options.miBox,"leaflet-traveltime-slider-container-min","leaflet-traveltime-slider-container-max"),this.removeAndAddClass(this.options.travelTimeInfo,"travel-time-info-min","travel-time-info-max"),this.removeAndAddClass(this.options.travelTimeSlider,"leaflet-traveltime-slider-min","leaflet-traveltime-slider-max"))},removeAndAddClass:function(t,e,n){$(t).addClass(n),$(t).removeClass(e)},onSlideStop:function(t){var e=this.options;e.onSlideStop=t},setValue:function(t){$(this.options.travelTimeSlider).slider("value",t),$(this.options.travelTimeSpan).text(t)},getValues:function(){for(var t=this.options,e=new Array,n=0;n<$(this.options.travelTimeSlider).slider("value");n+=t.step)e.push(t.travelTimes[n/t.step].time);return e},getMaxValue:function(){return _.max(this.getValues())}}),s.travelTimeControl=function(t){return new s.TravelTimeControl(t)},s.waitControl=function(t){return new L.Control.WaitControl(t)},L.Control.WaitControl=L.Control.extend({options:{position:"topleft"},initialize:function(t){L.Util.setOptions(this,t)},onAdd:function(t){this.options.map=t,this.options.mapId=$(t._container).attr("id");var e=L.DomUtil.create("div","leaflet-control-wait");return $(e).append('<div id="wait-control-'+this.options.mapId+'" class="mi-box waitControl">                 <i class="fa fa-spinner fa-spin"></i> '+("undefined"!=typeof this.options.text?this.options.text:s.config.i18n.get("wait"))+"            </div>"),e},updateText:function(t){$("#wait-control-"+this.options.mapId).html('<i class="fa fa-spinner fa-spin"></i> '+t),$("span[lang][lang!='"+s.config.i18n.language+"']").hide()},show:function(){$("#wait-control-"+this.options.mapId).show()},hide:function(){$("#wait-control-"+this.options.mapId).hide()}}),s.htmlControl=function(t){return new L.Control.HtmlControl(t)},L.Control.HtmlControl=L.Control.extend({options:{position:"topleft"},initialize:function(t){L.Util.setOptions(this,t)},onAdd:function(t){this.options.id=$(t._container).attr("id")+s.Util.generateId();
var e=L.DomUtil.create("div","leaflet-control-html");return $(e).append('<div id="html-control-'+this.options.id+'" class="html-control '+this.options.classes+'"></div>'),$(e).on("mouseover",function(){t.scrollWheelZoom.disable()}),$(e).on("mouseout",function(){t.scrollWheelZoom.enable()}),e},setHtml:function(t){$("#html-control-"+this.options.id).html(t)},show:function(){$("#html-control-"+this.options.id).show()},hide:function(){$("#html-control-"+this.options.id).hide()},toggle:function(){$("#html-control-"+this.options.id).toggle()}}),s.RadioButtonControl=L.Control.extend({initialize:function(t){this.options=JSON.parse(JSON.stringify(s.config.defaultRadioOptions)),"undefined"!=typeof t?("undefined"!=typeof t.position&&(this.options.position=t.position),"undefined"!=typeof t.buttons&&(this.options.buttons=t.buttons),"undefined"!=typeof t.onChange&&(this.options.onChange=t.onChange)):alert("No buttons supplied!")},onAdd:function(t){var e=this;this.options.map=t;var n=L.DomUtil.create("div",this._container);return this.options.input=this.getRadioButtonHTML(),$(n).append(this.options.input),$(this.options.input).buttonset({}).change(function(){e.options.checked=$("input[name='r360_radiobuttongroup_"+e.options.buttonGroupId+"']:checked").attr("key"),e.options.onChange(e.options.checked)}),$(this.options.input).each(function(){$(this).tooltip({open:function(){$("[lang='de'], [lang='en'], [lang='no']").hide(),$("[lang='"+s.config.i18n.language+"']").show()},content:function(){return $(this).attr("title")},position:{my:"center top+10",at:"center bottom",using:function(t,e){$(this).css(t),$("<div>").addClass("arrow top").addClass(e.vertical).addClass(e.horizontal).appendTo(this)}}})}),L.DomEvent.addListener(n,"click",L.DomEvent.stopPropagation),n},onChange:function(t){this.options.onChange=t},setValue:function(t){$("input[name='r360_radiobuttongroup_"+this.options.buttonGroupId+"']:checked").next().removeClass("ui-state-active");var e=$("input[name='r360_radiobuttongroup_"+this.options.buttonGroupId+"'][key='"+t+"']");e.attr("checked",!0),e.addClass("checked"),e.next().addClass("ui-state-active"),this.options.checked=t},getValue:function(){return this.options.checked},getRadioButtonHTML:function(){var t=this;t.options.buttonGroupId=s.Util.generateId(5);var e=$("<div/>",{id:t.options.buttonGroupId});return e.addClass("r360-box-shadow"),_.each(t.options.buttons,function(n){var i=s.Util.generateId(),o=$("<input/>",{type:"radio",id:"r360_"+i,value:n.key,key:n.key,name:"r360_radiobuttongroup_"+t.options.buttonGroupId}),a=$("<label/>",{"for":"r360_"+i,html:n.label});n.checked&&(t.options.checked=n.key,o.attr({checked:"checked"})),"undefined"!=typeof n.tooltip&&a.attr({title:n.tooltip}),e.append(o),e.append(a)}),e}}),s.radioButtonControl=function(t){return new s.RadioButtonControl(t)},s.CheckboxButtonControl=L.Control.extend({initialize:function(t){this.options=JSON.parse(JSON.stringify(s.config.defaultRadioOptions)),this.options.checked={},"undefined"!=typeof t?("undefined"!=typeof t.position&&(this.options.position=t.position),"undefined"!=typeof t.buttons&&(this.options.buttons=t.buttons),"undefined"!=typeof t.onChange&&(this.options.onChange=t.onChange)):alert("No buttons supplied!")},onAdd:function(t){var e=this;this.options.map=t;var n=L.DomUtil.create("div",this._container);return this.options.input=this.getCheckboxButtonHTML(),$(n).append(this.options.input),$(this.options.input).buttonset({}).change(function(){$("input:checkbox[name='r360_checkboxbuttongroup_"+e.options.buttonGroupId+"']").each(function(){e.options.checked[$(this).attr("key")]=$(this).is(":checked")?!0:!1}),e.options.onChange(e.options.checked)}),$(this.options.input).each(function(){$(this).tooltip({open:function(){$("[lang='de'], [lang='en'], [lang='no']").hide(),$("[lang='"+s.config.i18n.language+"']").show()},content:function(){return $(this).attr("title")},position:{my:"center top+10",at:"center bottom",using:function(t,e){$(this).css(t),$("<div>").addClass("arrow top").addClass(e.vertical).addClass(e.horizontal).appendTo(this)}}})}),L.DomEvent.addListener(n,"click",L.DomEvent.stopPropagation),n},onChange:function(t){this.options.onChange=t},getValue:function(){return this.options.checked},getId:function(){return this.id},getCheckboxButtonHTML:function(){var t=this;t.options.buttonGroupId=s.Util.generateId(5),t.id=t.options.buttonGroupId;var e=$("<div/>",{id:t.options.buttonGroupId});return e.addClass("r360-box-shadow"),_.each(t.options.buttons,function(n){var i=s.Util.generateId(),o=$("<input/>",{type:"checkbox",id:"r360_"+i,value:n.key,key:n.key,name:"r360_checkboxbuttongroup_"+t.options.buttonGroupId}),a=$("<label/>",{"for":"r360_"+i,html:_.isUndefined(n.icon)?""+n.label:n.icon+" "+n.label});n.checked&&(t.options.checked[n.key]=!0,o.attr({checked:"checked"})),"undefined"!=typeof n.tooltip&&a.attr({title:n.tooltip}),e.append(o),e.append(a)}),e}}),s.checkboxButtonControl=function(t){return new s.CheckboxButtonControl(t)},s.polygon=function(t,e,n){return new s.Polygon(t,e,n)},s.Polygon=function(t,e,n){var i=this;i.topRight=new L.latLng(-90,-180),i.bottomLeft=new L.latLng(90,180),i.travelTime=t,i.area=e,i.color,i.outerBoundary=n,i.innerBoundaries=new Array,i.innerProjectedBoundaries=new Array,i.setOuterBoundary=function(t){i.outerBoundary=t},i.projectOuterBoundary=function(){i.outerProjectedBoundary=new Array;for(var t=0;t<i.outerBoundary.length;t++)i.outerProjectedBoundary.push(s.Util.webMercatorToLeaflet(i.outerBoundary[t]))},i.project=function(){i.projectOuterBoundary()},i.addInnerBoundary=function(t){var e={};e.projectedBottomLeft=new L.Point(20026377,20048967),e.projectedTopRight=new L.Point(-20026377,-20048967);for(var n=t.length-1;n>=0;n--)t[n].x>e.projectedTopRight.x&&(e.projectedTopRight.x=t[n].x),t[n].y>e.projectedTopRight.y&&(e.projectedTopRight.y=t[n].y),t[n].x<e.projectedBottomLeft.x&&(e.projectedBottomLeft.x=t[n].x),t[n].y<e.projectedBottomLeft.y&&(e.projectedBottomLeft.y=t[n].y);e.topRight=s.Util.webMercatorToLatLng(new L.Point(e.projectedTopRight.x,e.projectedTopRight.y)),e.bottomLeft=s.Util.webMercatorToLatLng(new L.Point(e.projectedBottomLeft.x,e.projectedBottomLeft.y)),e.projectedBottomLeft=s.Util.webMercatorToLeaflet(e.projectedBottomLeft),e.projectedTopRight=s.Util.webMercatorToLeaflet(e.projectedTopRight),e.points=new Array,i.innerProjectedBoundaries.push(e);for(var o=0;o<t.length;o++)e.points.push(s.Util.webMercatorToLeaflet(t[o]));e.getProjectedBottomLeft=function(){return new L.Point(this.projectedBottomLeft.x,this.projectedBottomLeft.y)},e.getProjectedTopRight=function(){return new L.Point(this.projectedTopRight.x,this.projectedTopRight.y)}},i.getBoundingBox=function(){return new L.LatLngBounds(this._bottomLeft,this._topRight)},i.getProjectedBottomLeft=function(){return new L.Point(i.projectedBottomLeft.x,i.projectedBottomLeft.y)},i.getProjectedTopRight=function(){return new L.Point(i.projectedTopRight.x,i.projectedTopRight.y)},i.setBoundingBox=function(){this.projectedBottomLeft=new L.Point(20026377,20048967),this.projectedTopRight=new L.Point(-20026377,-20048967);for(var t=this.outerBoundary.length-1;t>=0;t--)this.outerBoundary[t].x>this.projectedTopRight.x&&(this.projectedTopRight.x=this.outerBoundary[t].x),this.outerBoundary[t].y>this.projectedTopRight.y&&(this.projectedTopRight.y=this.outerBoundary[t].y),this.outerBoundary[t].x<this.projectedBottomLeft.x&&(this.projectedBottomLeft.x=this.outerBoundary[t].x),this.outerBoundary[t].y<this.projectedBottomLeft.y&&(this.projectedBottomLeft.y=this.outerBoundary[t].y);this.topRight=s.Util.webMercatorToLatLng(new L.Point(this.projectedTopRight.x,this.projectedTopRight.y)),this.bottomLeft=s.Util.webMercatorToLatLng(new L.Point(this.projectedBottomLeft.x,this.projectedBottomLeft.y)),this.projectedTopRight=s.Util.webMercatorToLeaflet(this.projectedTopRight),this.projectedBottomLeft=s.Util.webMercatorToLeaflet(this.projectedBottomLeft)},i.setBoundingBox(),i.getColor=function(){return i.color},i.setTravelTime=function(t){i.travelTime=t},i.getTravelTime=function(){return i.travelTime},i.setColor=function(t){i.color=t},i.setOpacity=function(t){i.opacity=t},i.getOpacity=function(){return i.opacity},i.setArea=function(t){i.area=t},i.getArea=function(){return i.area}},s.MultiPolygon=function(){var t=this;t._topRight=new L.latLng(-90,-180),t._bottomLeft=new L.latLng(90,180),t.travelTime,t.color,t.polygons=new Array,t.addPolygon=function(e){t.polygons.push(e)},t.setOpacity=function(e){t.opacity=e},t.getOpacity=function(){return t.opacity},t.setColor=function(e){t.color=e},t.getColor=function(){return t.color},t.getTravelTime=function(){return t.travelTime},t.setTravelTime=function(e){t.travelTime=e},t.getBoundingBox=function(){return new L.LatLngBounds(t._bottomLeft,t._topRight)},t.setBoundingBox=function(){_.each(t.polygons,function(e){e._topRight.lat>t._topRight.lat&&(t._topRight.lat=e._topRight.lat),e._bottomLeft.lat<t._bottomLeft.lat&&(t._bottomLeft.lat=e._bottomLeft.lat),e._topRight.lng>t._topRight.lng&&(t._topRight.lng=e._topRight.lng),e._bottomLeft.lng<t._bottomLeft.lng&&(t._bottomLeft.lng=e._bottomLeft.lng)})}},s.multiPolygon=function(){return new s.MultiPolygon},s.RouteSegment=function(t){var e=this;if(e.points=[],e.type=t.type,e.travelTime=t.travelTime,e.distance=t.length/1e3,e.warning=t.warning,e.elevationGain=t.elevationGain,e.errorMessage,e.transitSegment=!1,e.startname=t.startname,e.endname=t.endname,_.each(t.points,function(t){e.points.push(s.Util.webMercatorToLatLng(new L.Point(t[1],t[0]),t[2]))}),t.isTransit){var n=_.findWhere(s.config.routeTypes,{routeType:t.routeType});e.color="undefined"!=typeof n&&_.has(n,"color")?n.color:"RED",e.haloColor="undefined"!=typeof n&&_.has(n,"haloColor")?n.haloColor:"WHITE",e.transitSegment=!0,e.routeType=t.routeType,e.routeShortName=t.routeShortName,e.startname=t.startname,e.endname=t.endname,e.departureTime=t.departureTime,e.arrivalTime=t.arrivalTime,e.tripHeadSign=t.tripHeadSign}else{var n=_.findWhere(s.config.routeTypes,{routeType:t.type});e.color="undefined"!=typeof n&&_.has(n,"color")?n.color:"RED",e.haloColor="undefined"!=typeof n&&_.has(n,"haloColor")?n.haloColor:"WHITE"}e.getPoints=function(){return e.points},e.getType=function(){return e.type},e.getHaloColor=function(){return e.haloColor},e.getColor=function(){return e.color},e.getTravelTime=function(){return e.travelTime},e.getDistance=function(){return e.distance},e.getRouteType=function(){return e.routeType},e.getRouteShortName=function(){return e.routeShortName},e.getStartName=function(){return e.startname},e.getEndName=function(){return e.endname},e.getDepartureTime=function(){return e.departureTime},e.getArrivalTime=function(){return e.arrivalTime},e.getTripHeadSign=function(){return e.tripHeadSign},e.getWarning=function(){return e.warning},e.getElevationGain=function(){return e.elevationGain},e.isTransit=function(){return e.transitSegment}},s.routeSegment=function(t){return new s.RouteSegment(t)},s.Route=function(t,e){var i=this;i.travelTime=t,i.routeSegments=[],i.points=[],i.uphillMeter=0,i.downhillMeter=0,i.targetHeight=n,i.sourceHeight=n,_.each(e.reverse(),function(t){var e=s.routeSegment(t);i.routeSegments.push(e),i.points=i.points.concat(e.getPoints().reverse())}),i.equals=function(t){return i.getKey()===t.getKey()},i.getKey=function(){var e=t,n="";return _.each(i.getSegments(),function(t){e+=" "+t.getRouteShortName()+" "+t.getDepartureTime()+" "+t.getArrivalTime(),_.each(t.getPoints(),function(t){n+=" "+t.lat+t.lng})}),e+n},i.addRouteSegment=function(t){i.routeSegments.push(t)},i.setTravelTime=function(t){i.travelTime=t},i.getDistance=function(){for(var t=0,e=0;e<i.routeSegments.length;e++)t+=i.routeSegments[e].getDistance();return t},i.getElevationGain=function(){for(var t=0,e=0;e<i.routeSegments.length;e++)t+=i.routeSegments[e].getElevationGain();return t},i.getElevations=function(){for(var t={x:[],y:[]},e=0;e<1e3*i.getDistance();e+=100)t.x.push(e/1e3+" km"),t.y.push(i.getElevationAt(e));return t},i.getElevationAt=function(t){for(var e=0,n=1;n<i.points.length;n++){var o=i.points[n-1],s=i.points[n],a=o.distanceTo(s);if(e+=a,e>t)return s.alt}},i.getSegments=function(){return i.routeSegments},i.getUphillElevation=function(){return i.uphillMeter},i.getDownhillElevation=function(){return i.downhillMeter},i.getTotalElevationDifference=function(){return Math.abs(i.sourceHeight-i.targetHeight)},i.setElevationDifferences=function(){for(var t=n,e=i.points.length-1;e>=0;e--)0==e&&(i.targetHeight=i.points[e].alt),e==i.points.length-1&&(i.sourceHeight=i.points[e].alt),"undefined"!=typeof t&&(t>i.points[e].alt?i.uphillMeter+=t-i.points[e].alt:t<i.points[e].alt&&(i.downhillMeter+=i.points[e].alt-t)),t=i.points[e].alt}(),i.getTravelTime=function(){return i.travelTime},i.fadeIn=function(t,e,n,o,s){function a(t){segment=i.routeSegments[t],percent="travelTime"==n?segment.getTravelTime()/i.getTravelTime():segment.getDistance()/i.getDistance(),timeToDraw=percent*e,"TRANSFER"!=segment.getType()?p(segment,timeToDraw,o,t):(("undefined"==typeof o||o.paintTransfer||"undefined"!=typeof o&&!_.has(o,"paintTransfer"))&&r(segment,o),++t<i.routeSegments.length&&a(t))}function r(t,e){l(t.points[0],t,e),t.points.length>1&&t.points[0].lat!=t.points[1].lat&&t.points[0].lng!=t.points[1].lng&&l(t.points[1],t,e)}function l(e,n,i){var o=L.circleMarker(e,{color:!_.isUndefined(i)&&_.has(i,"transferColor")?i.transferColor:n.getColor(),fillColor:!_.isUndefined(i)&&_.has(i,"transferHaloColor")?i.transferHaloColor:"undefined"!=typeof n.getHaloColor()?n.getHaloColor():"#9D9D9D",fillOpacity:!_.isUndefined(i)&&_.has(i,"transferFillOpacity")?i.transferFillOpacity:1,opacity:!_.isUndefined(i)&&_.has(i,"transferOpacity")?i.transferOpacity:1,stroke:!_.isUndefined(i)&&_.has(i,"transferStroke")?i.transferStroke:!0,weight:!_.isUndefined(i)&&_.has(i,"transferWeight")?i.transferWeight:4,radius:!_.isUndefined(i)&&_.has(i,"transferRadius")?i.transferRadius:8}),s=!_.isUndefined(i)&&_.has(i,"popup")?i.popup:"INSERT_TEXT";if("undefined"!=typeof n){var a=_.contains(["walk","transit","source","target","bike","car"],n.startname)?"":n.startname;a=""!=a||_.contains(["walk","transit","source","target","bike","car"],n.endname)?a:n.endname,s=s.replace("INSERT_TEXT",a)}!_.isUndefined(i)&&_.has(i,"popup")&&(o.bindPopup(s),o.on("mouseover",function(){o.openPopup()})),o.addTo(t),o.bringToFront()}function p(e,n,i,o){var a={};a.color=!_.isUndefined(i)&&_.has(i,"color")?i.color:e.getColor(),a.opacity=!_.isUndefined(i)&&_.has(i,"opacity")?i.opacity:.8,a.weight=!_.isUndefined(i)&&_.has(i,"weight")?i.weight:5,"TRANSIT"!=e.getType()&&"WALK"==e.getType()&&(a.color=!_.isUndefined(i)&&_.has(i,"walkColor")?i.walkColor:"#006F35",a.weight=!_.isUndefined(i)&&_.has(i,"walkWeight")?i.walkWeight:7,a.dashArray=!_.isUndefined(i)&&_.has(i,"walkDashArray")?i.walkDashArray:"1, 10");var r={};r.weight=!_.isUndefined(i)&&_.has(i,"haloWeight")?i.haloWeight:10,r.opacity=!_.isUndefined(i)&&_.has(i,"haloOpacity")?i.haloOpacity:.7,r.color=!_.isUndefined(i)&&_.has(i,"haloColor")?i.haloColor:"undefined"!=typeof e.getHaloColor()?e.getHaloColor():"#9D9D9D";var l=n/15,p=u(e.getPoints(),l),h=L.polyline(p[0],r).addTo(t),c=L.polyline(p[0],a).addTo(t);h.on("click",s),c.on("click",s),d(c,h,p,1,o)}function d(t,e,n,o,s){for(var r=t.getLatLngs(),l=0;l<n[o].length;l++)r.push(n[o][l]);0!=r.length&&(e.setLatLngs(r),t.setLatLngs(r)),++o<n.length?setTimeout(function(){d(t,e,n,o,s)},15):++s<i.routeSegments.length&&a(s)}function u(t,e){for(var n,i,o=0,s=1/e,a=0,r=new Array,l=1;l<t.length;l++)o+=t[l-1].distanceTo(t[l]);for(var p=new Array,l=0;l<t.length-1;l++)if(p.push(t[l]),n=t[l].distanceTo(t[l+1]),i=n/o,a+=i,a>=s)for(;a>=s;)percent=(s-(a-i))/i,p.push(h(t[l],t[l+1],percent)),s+=1/e,r.push(p),p=new Array;return r.push(p),p=new Array,p.push(t[t.length-1]),r.push(p),r}function h(e,n,i){var o;o="undefined"!=typeof t.project?t:t._map;var s=o.project(e),a=o.project(n),r=(a.x-s.x)*i+s.x,l=(a.y-s.y)*i+s.y,p=new L.point(r,l),d=o.unproject(p);return d}"undefined"==typeof e&&(e=0),"undefined"==typeof n&&(n="travelTime"),a(0)}},s.route=function(t,e){return new s.Route(t,e)},s.Route360PolygonLayer=L.Class.extend({initialize:function(t){this.multiPolygons=[],this.opacity=s.config.defaultPolygonLayerOptions.opacity,this.strokeWidth=s.config.defaultPolygonLayerOptions.strokeWidth,this.tolerance=s.config.defaultPolygonLayerOptions.tolerance,this.extendWidthX=s.config.defaultPolygonLayerOptions.strokeWidth/2,this.extendWidthY=s.config.defaultPolygonLayerOptions.strokeWidth/2,this.backgroundColor=s.config.defaultPolygonLayerOptions.backgroundColor,this.backgroundOpacity=s.config.defaultPolygonLayerOptions.backgroundOpacity,this.topRight={lat:-90,lng:-180},this.bottomLeft={lat:90,lng:180},"undefined"!=typeof t&&("undefined"!=typeof t.opacity&&(this.opacity=t.opacity),"undefined"!=typeof t.strokeWidth&&(this.strokeWidth=t.strokeWidth),"undefined"!=typeof t.inverse&&(this.inverse=t.inverse),"undefined"!=typeof t.tolerance&&(this.tolerance=t.tolerance),"undefined"!=typeof t.extendWidthX&&(this.extendWidthX=t.extendWidthX),"undefined"!=typeof t.extendWidthY&&(this.extendWidthY=t.extendWidthY))},setInverse:function(t){this.inverse=t},getInverse:function(){return this.inverse},getBoundingBox:function(){return new L.LatLngBounds(this.bottomLeft,this.topRight)},onAdd:function(t){this.map=t,this.element=L.DomUtil.create("div","r360-leaflet-polygon-layer-"+$(t._container).attr("id")+" leaflet-zoom-hide"),$(this.element).attr("id","canvas"+$(this.map._container).attr("id")),this.map.getPanes().overlayPane.appendChild(this.element),this.map.on("moveend",this.draw,this),this.draw()},fitMap:function(){this.map.fitBounds(this.getBoundingBox())},clearAndAddLayers:function(t,e){return this.clearLayers(),this.addLayer(t),"undefined"!=typeof e&&this.fitMap(),this},addLayer:function(t){this.multiPolygons=s.PolygonUtil.prepareMultipolygons(t,this.topRight,this.bottomLeft),this.draw()},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){t.getPanes().overlayPane.removeChild(this.element),t.off("viewreset",this.draw,this)},createSvgData:function(t){var e=s.PolygonUtil.extendBounds(this.getMapPixelBounds(),this.extendWidthX,this.extendWidthY);return s.SvgUtil.createSvgData(t,{bounds:e,scale:256*Math.pow(2,this.map._zoom),tolerance:this.tolerance,pixelOrigin:this.map.getPixelOrigin(),offset:this.offset})},getMapPixelBounds:function(){var t=this.map.getPixelBounds();return{max:{x:t.max.x,y:t.max.y},min:{x:t.min.x,y:t.min.y}}},clearLayers:function(){$("#canvas"+$(this.map._container).attr("id")).empty(),this.initialize()},draw:function(){if(this.multiPolygons.length>0){this.svgWidth=this.map.getSize().x,this.svgHeight=this.map.getSize().y,s.DomUtil.setPosition(this.element,{x:0,y:0});var t=$("#svg_"+$(this.map._container).attr("id")).offset(),e=$(this.map._container).offset();"undefined"==typeof this.offset&&(this.offset={x:0,y:0}),"undefined"!=typeof t&&(this.offset.x+=e.left-t.left,this.offset.y+=e.top-t.top),$("#canvas"+$(this.map._container).attr("id")).empty();for(var n=[],i=0;i<this.multiPolygons.length;i++){for(var o=this.multiPolygons[i],a=[],r=0;r<o.polygons.length;r++)a.push(this.createSvgData(o.polygons[r]));0!=a.length&&n.push(s.SvgUtil.getGElement(a,{color:this.inverse?"black":o.getColor(),opacity:this.inverse?o.getOpacity():1,strokeWidth:s.config.defaultPolygonLayerOptions.strokeWidth}))}var l={id:$(this.map._container).attr("id"),offset:this.offset,svgHeight:this.svgHeight,svgWidth:this.svgWidth,backgroundColor:this.backgroundColor,backgroundOpacity:this.backgroundOpacity,opacity:this.opacity,strokeWidth:this.strokeWidth};$("#canvas"+$(this.map._container).attr("id")).append(this.inverse?s.SvgUtil.getInverseSvgElement(n,l):s.SvgUtil.getNormalSvgElement(n,l))}}}),s.route360PolygonLayer=function(t){return new s.Route360PolygonLayer(t)}}(window,document),window.google&&(GoogleMapsPolygonLayer.prototype=new google.maps.OverlayView,GoogleMapsPolygonLayer.prototype.onAdd=function(){this.element=document.createElement("div"),this.element.id="r360-googlemaps-polygon-layer-canvas-in-"+this.id,this.getPanes().overlayLayer.appendChild(this.element)},GoogleMapsPolygonLayer.prototype.getMapPixelBounds=function(){var t=r360.Util.googleLatlngToPoint(this.map,this.map.getBounds().getSouthWest(),this.map.getZoom()),e=r360.Util.googleLatlngToPoint(this.map,this.map.getBounds().getNorthEast(),this.map.getZoom());return{max:{x:e.x,y:t.y},min:{x:t.x,y:e.y}}},GoogleMapsPolygonLayer.prototype.getPixelOrigin=function(){var t=r360.PolygonUtil.divide({x:this.map.getDiv().offsetWidth,y:this.map.getDiv().offsetHeight},2),e=r360.Util.googleLatlngToPoint(this.map,this.map.getCenter(),this.map.getZoom());return r360.PolygonUtil.roundPoint(r360.PolygonUtil.subtract(e,t.x,t.y))},GoogleMapsPolygonLayer.prototype.setInverse=function(t){console.log("inverse"),this.inverse!=t&&(this.inverse=t,this.draw())},GoogleMapsPolygonLayer.prototype.createSvgData=function(t){var e=r360.PolygonUtil.extendBounds(this.getMapPixelBounds(),this.extendWidthX,this.extendWidthY),n=r360.SvgUtil.createSvgData(t,{bounds:e,scale:256*Math.pow(2,this.map.getZoom()),tolerance:this.tolerance,pixelOrigin:this.getPixelOrigin(),offset:{x:0,y:0}});return n},GoogleMapsPolygonLayer.prototype.draw=function(){if(this.multiPolygons.length>0){this.svgWidth=this.map.getDiv().offsetWidth,this.svgHeight=this.map.getDiv().offsetHeight,r360.DomUtil.setPosition(this.element,{x:0,y:0});var t=$("#svg_"+this.id).offset(),e=$(this.map.getDiv()).offset();"undefined"==typeof this.offset&&(this.offset={x:0,y:0}),"undefined"!=typeof t&&(this.offset.x+=e.left-t.left,this.offset.y+=e.top-t.top),$("#"+this.element.id).empty();for(var n=[],i=0;i<this.multiPolygons.length;i++){for(var o=this.multiPolygons[i],s=[],a=0;a<o.polygons.length;a++)s.push(this.createSvgData(o.polygons[a]));0!=s.length&&n.push(r360.SvgUtil.getGElement(s,{color:this.inverse?"black":o.getColor(),opacity:this.inverse?o.getOpacity():1,strokeWidth:this.strokeWidth}))}var r={id:this.id,offset:this.offset,svgHeight:this.svgHeight,svgWidth:this.svgWidth,backgroundColor:this.backgroundColor,backgroundOpacity:this.backgroundOpacity,opacity:this.opacity,strokeWidth:this.strokeWidth};$("#"+this.element.id).append(this.inverse?r360.SvgUtil.getInverseSvgElement(n,r):r360.SvgUtil.getNormalSvgElement(n,r))}},GoogleMapsPolygonLayer.prototype.update=function(t){this.topRight={lat:-90,lng:-180},this.bottomLeft={lat:-90,lng:180},this.multiPolygons=r360.PolygonUtil.prepareMultipolygons(t,this.topRight,this.bottomLeft),console.log(this.getMap()),this.setMap(this.getMap()),this.draw()},GoogleMapsPolygonLayer.prototype.addListener=function(){var t=this.map,e=this;google.maps.event.addListener(t,"zoom_changed",function(){e.onRemove(),google.maps.event.addListenerOnce(t,"idle",function(){e.draw()})}),google.maps.event.addListener(t,"dragend",function(){google.maps.event.addListenerOnce(t,"idle",function(){e.draw()})})},GoogleMapsPolygonLayer.prototype.onRemove=function(){$("#"+this.element.id).empty()});