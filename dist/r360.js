/*
 Route360° JavaScript API v0.0.9 (82d3013), a JS library for leaflet maps. http://route360.net
 (c) 2014 Henning Hollburg and Daniel Gerber, (c) 2014 Motion Intelligence GmbH
*/
!function(e,t,n){function o(){var t=e.r360;a.noConflict=function(){return e.r360=t,this},e.r360=a}var a={version:"v0.0.9"};"object"==typeof module&&"object"==typeof module.exports?module.exports=a:"function"==typeof define&&define.amd?define(a):o(),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),i=this,n=function(){},o=function(){return i.apply(this instanceof n&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,o.prototype=new n,o}),a.config={serviceUrl:"https://api.route360.net/api_dev/",serviceUrl:"http://localhost:8080/api/",nominatimUrl:"https://geocode.route360.net/",osmServiceUrl:"https://api.route360.net/r360-osm-api-norway/",serviceVersion:"v1",pathSerializer:"compact",requestTimeout:1e4,maxRoutingTime:3600,bikeSpeed:15,bikeUphill:20,bikeDownhill:-10,walkSpeed:5,walkUphill:10,walkDownhill:0,travelTimes:[300,600,900,1200,1500,1800],travelType:"walk",logging:!1,defaultTravelTimeControlOptions:{travelTimes:[{time:300,color:"#006837",opacity:.1},{time:600,color:"#39B54A",opacity:.2},{time:900,color:"#8CC63F",opacity:.3},{time:1200,color:"#F7931E",opacity:.4},{time:1500,color:"#F15A24",opacity:.5},{time:1800,color:"#C1272D",opacity:1}],position:"topright",label:"travel time",initValue:30},routeTypes:[{routeType:"WALK",color:"red",haloColor:"white"},{routeType:"BIKE",color:"#558D54",haloColor:"white"},{routeType:"CAR",color:"#558D54",haloColor:"white"},{routeType:"TRANSFER",color:"#C1272D",haloColor:"white"},{routeType:102,color:"#006837",haloColor:"white"},{routeType:400,color:"#156ab8",haloColor:"white"},{routeType:900,color:"red",haloColor:"white"},{routeType:700,color:"#A3007C",haloColor:"white"},{routeType:1e3,color:"blue",haloColor:"white"},{routeType:109,color:"#006F35",haloColor:"white"},{routeType:100,color:"red",haloColor:"white"},{routeType:1,color:"red",haloColor:"red"},{routeType:2,color:"blue",haloColor:"blue"},{routeType:3,color:"yellow",haloColor:"yellow"},{routeType:0,color:"green",haloColor:"green"},{routeType:4,color:"orange",haloColor:"orange"},{routeType:5,color:"red",haloColor:"red"},{routeType:6,color:"blue",haloColor:"blue"},{routeType:7,color:"yellow",haloColor:"yellow"}],defaultPlaceAutoCompleteOptions:{serviceUrl:"https://geocode.route360.net/solr/select?",position:"topleft",reset:!1,reverse:!1,placeholder:"Select source",maxRows:5,width:300},photonPlaceAutoCompleteOptions:{serviceUrl:"https://geocode2.route360.net/photon/api?",position:"topleft",reset:!1,reverse:!1,placeholder:"Select source",maxRows:5,width:300},defaultRadioOptions:{position:"topright"},defaultPolygonLayerOptions:{opacity:.4,strokeWidth:30,tolerance:15,backgroundColor:"black",backgroundOpacity:.5,inverse:!1,animate:!1,animationDuration:1},i18n:{language:"en",configuredLangguages:["en","de","no"],slow:{en:"Slow",de:"Langsam",no:"Sakte"},medium:{en:"Medium",de:"Mittel",no:"Medium"},fast:{en:"Fast",de:"Schnell",no:"Raskt"},departure:{en:"Departure",de:"Abfahrt",no:"TODO TRANSLATION: "},placeholderSrc:{en:"Select source!",de:"Start wählen!",no:"Velg start!"},placeholderTrg:{en:"Select target!",de:"Ziel wählen!",no:"Velg en destinasjon!"},line:{en:"Line",de:"Linie",no:"TODO TRANSLATION: "},arrival:{en:"Arrival",de:"Ankunft",no:"TODO TRANSLATION: "},from:{en:"From",de:"Von",no:"TODO TRANSLATION: "},to:{en:"To",de:"Nach",no:"TODO TRANSLATION: "},travelTime:{en:"Travel time",de:"Reisezeit",no:"Reisetid"},totalTime:{en:"Total time",de:"Gesamtzeit",no:"TODO TRANSLATION: "},batteryCapacity:{en:"Battery capacity: ",de:"Akkuleistung: ",no:"TODO TRANSLATION: "},distance:{en:"Distance",de:"Distanz",no:"Avstand"},wait:{en:"Please wait!",de:"Bitte warten!",no:"Vennligst vent!"},polygonWait:{en:"Calculating reachable area!",de:"Berechne erreichbare Fläche!",no:"TODO TRANSLATION"},routeWait:{en:"Searching route to target(s)!",de:"Suche Route zum Ziel!",no:"TODO TRANSLATION"},timeWait:{en:"Getting travel times to target(s)!",de:"Berechne Reisezeiten für Ziele!",no:"TODO TRANSLATION"},osmWait:{en:"Searching for points of interests!",de:"Suche nach Sehenswürdigkeiten!",no:"TODO TRANSLATION"},populationWait:{en:"Calculating population statistics!",de:"Berechne Bevölkerungsstatistik!",no:"TODO TRANSLATION"},elevation:{en:"Elevation",de:"Höhenunterschied",no:"Stigning"},timeFormat:{en:"a.m.",de:"Uhr",no:"TODO_TRANSLATION"},reset:{en:"Reset input",de:"Eingeben löschen",no:"Tilbakestill innspill"},reverse:{en:"Switch source and target",de:"Start und Ziel tauschen",no:"Sett på start og slutt"},settings:{en:"Switch travel type",de:"Reisemodus wechseln",no:"TODO TRANSLATION"},noRouteFound:{en:"No route found!",de:"Keine Route gefunden!",no:"TODO TRANSLATION"},monthNames:{en:["January","February","March","April","May","June","July","August","September","October","November","December"],de:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],no:["TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION"]},dayNames:{en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],de:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],no:["TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION"]},dayNamesMin:{en:["Su","Mo","Tu","We","Th","Fr","Sa"],de:["So","Mo","Di","Mi","Do","Fr","Sa"],no:["TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION"]},museum:{en:"Museums",de:"Museen",no:"Museer"},swimming_pool:{en:"Schwimmbäder",de:"Swimming pools",no:"Svømmebassenger"},restaurant:{en:"Restaurants",de:"Restaurants",no:"Restauranter"},getSpan:function(e){var t="";return _.each(_.keys(a.config.i18n[e]),function(i){t+='<span lang="'+i+'">'+a.config.i18n[e][i]+"</span>"}),t},get:function(e){var t;return _.each(_.keys(a.config.i18n),function(i){e==i&&(t=a.config.i18n[e][a.config.i18n.language])}),t}}},a.Util={getTimeInSeconds:function(){var e=new Date;return 3600*e.getHours()+60*e.getMinutes()+e.getSeconds()},getHoursAndMinutesInSeconds:function(){var e=new Date;return 3600*e.getHours()+60*e.getMinutes()},getCurrentDate:function(){var e=new Date,t=e.getFullYear(),i=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,n=e.getDate()<10?"0"+e.getDate():e.getDate();return t+""+i+n},getTimeFormat:function(e){var t=a.config.i18n;return"en"==t.language&&e>=43200?"p.m.":t.get("timeFormat")},secondsToHoursAndMinutes:function(e){var t=(e/60).toFixed(0),i=Math.floor(t/60);t-=60*i;var n="";return 0!=i&&(n+=i+"h "),n+=t+"min"},secondsToTimeOfDay:function(e){var t=Math.floor(e/3600),i=Math.floor(e/60)-60*t;return e=e-3600*t-60*i,t+":"+("0"+i).slice(-2)+":"+("0"+e).slice(-2)},generateId:function(e){var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return _.each(_.range(e?e:10),function(){t+=i.charAt(Math.floor(Math.random()*i.length))}),t},parseLatLonArray:function(e){for(var t=new Array,i=0;i<e.length;i++)t.push(new L.Point(e[i][0],e[i][1]));return t},routeToLeafletPolylines:function(e,t){t="undefined"!=typeof t?t:{};var i=[];return _.each(e.getSegments(),function(n,o){if("TRANSFER"!=n.getType()){var a={};a.color=_.has(t,"color")?t.color:n.getColor();var r={};r.weight=7,r.color="white",(0==o||o==e.getLength()-1)&&(a.dashArray="1, 8");var s=L.polyline(n.getPoints(),r),l=L.polyline(n.getPoints(),a);i.push([s,l])}}),i},getAddressByCoordinates:function(e,t,i){$.getJSON(a.config.nominatimUrl+"reverse.php?&format=json&lat="+e.lat+"&accept-language="+t+"&lon="+e.lng+"&json_callback=?",i)},formatReverseGeocoding:function(e){var t=[];_.has(e.address,"road")&&t.push(e.address.road),_.has(e.address,"house_number")&&t.push(e.address.house_number);var i=[];_.has(e.address,"postcode")&&i.push(e.address.postcode),_.has(e.address,"city")&&i.push(e.address.city);var n=[];return t.length>0&&n.push(t.join(" ")),i.length>0&&n.push(i.join(", ")),0==t.length&&0==i.length&&n.push(e.display_name),n.join(", ")},parsePolygons:function(e){if(e.error)return errorMessage;if(a.config.logging)var t=(new Date).getTime();var i=[];return _.each(e,function(e){var t={id:e.id,polygons:[]};_.each(e.polygons,function(e){var i=a.polygon(e.travelTime,e.area,a.Util.parseLatLonArray(e.outerBoundary)),n=_.findWhere(a.config.defaultTravelTimeControlOptions.travelTimes,{time:i.getTravelTime()});i.setColor(_.isUndefined(n)?"#000000":n.color);var o=_.findWhere(a.config.defaultTravelTimeControlOptions.travelTimes,{time:i.getTravelTime()});i.setOpacity(_.isUndefined(o)?1:o.opacity),_.each(e.innerBoundary,function(e){i.addInnerBoundary(a.Util.parseLatLonArray(e))}),t.polygons.push(i)}),i.push(t)}),a.config.logging&&console.log("Polygon parsing took: "+((new Date).getTime()-t)+"ms"),i},parseRoutes:function(e){var t=new Array;return _.each(e.routes,function(e){t.push(a.route(e.travelTime,e.segments))}),t},getMarker:function(e,t){var i=_.has(t,"color")?"-"+t.color:"-blue";return t.icon=L.icon({iconSize:[25,41],iconUrl:t.iconPath+"marker-icon"+i+".png",iconAnchor:[12,41],shadowSize:[41,41],shadowUrl:t.iconPath+"marker-shadow.png",shadowAnchor:[41/3,41],popupAnchor:[0,-35]}),L.marker(e,t)},webMercatorToLeaflet:function(e){return e.x/=6378137,e.y/=6378137,L.CRS.EPSG3857.transformation._transform(e),e},webMercatorToLatLng:function(e,t){var i=L.CRS.EPSG3857.projection.unproject(new L.Point(e.x/=6378137,e.y/=6378137));return"undefined"!=typeof t?L.latLng([i.lat,i.lng,t]):i},latLngToWebMercator:function(e){var t=L.Projection.SphericalMercator.project(e);return t.x*=6378137,t.y*=6378137,t}},a.TravelOptions=function(){this.sources=[],this.targets=[],this.service,this.bikeSpeed=n,this.bikeUphill=n,this.bikeDownhill=n,this.walkSpeed=n,this.walkUphill=n,this.walkDownhill=n,this.supportWatts=n,this.renderWatts=n,this.travelTimes=n,this.travelType=n,this.elevationEnabled=n,this.minPolygonHoleSize=n,this.time=n,this.date=n,this.errors=[],this.intersectionMode=n,this.pathSerializer=a.config.pathSerializer,this.maxRoutingTime=n,this.waitControl,this.isValidPolygonServiceOptions=function(e){return this.errors=[],"[object Array]"===Object.prototype.toString.call(this.getSources())?0==this.getSources().length?this.getErrors().push("Sources do not contain any points!"):_.each(this.getSources(),function(e){_.has(e,"lat")||"function"==typeof e.getLatLng||this.getErrors().push("Sources contains source with undefined latitude!"),_.has(e,"lon")||_.has(e,"lng")||"function"==typeof e.getLatLng||this.getErrors().push("Sources contains source with undefined longitude!")}):this.getErrors().push("Sources are not of type array!"),_.contains(["bike","transit","walk","car","rentbike","rentandreturnbike","ebike"],this.getTravelType())?"car"==this.getTravelType()||("bike"==this.getTravelType()||"rentbike"==this.getTravelType()||"rentandreturnbike"==this.getTravelType()?(""!=typeof this.getBikeUphill()&&""!=typeof this.getBikeDownhill()&&"undefined"!=typeof this.getBikeUphill()&&(this.getBikeUphill()<0||this.getBikeDownhill()>0||this.getBikeUphill()<-this.getBikeDownhill())&&this.getErrors().push("Uphill cycle speed has to be larger then 0. Downhill cycle speed has to be smaller then 0.                             Absolute value of downhill cycle speed needs to be smaller then uphill cycle speed."),this.getBikeSpeed()<=0&&this.getErrors().push("Bike speed needs to be larger then 0.")):"walk"==this.getTravelType()?(""!=typeof this.getBikeUphill()&&""!=typeof this.getBikeDownhill()&&"undefined"!=typeof this.getBikeUphill()&&(this.getWalkUphill()<0||this.getWalkDownhill()>0||this.getWalkUphill()<-this.getWalkDownhill())&&this.getErrors().push("Uphill walking speed has to be larger then 0. Downhill walking speed has to be smaller then 0.                             Absolute value of downhill walking speed needs to be smaller then uphill walking speed."),this.getWalkSpeed()<=0&&this.getErrors().push("Walk speed needs to be larger then 0.")):"transit"==this.getTravelType()):this.getErrors().push("Not supported travel type given: "+this.getTravelType()),e||("undefined"==typeof this.getTravelTimes()||"[object Array]"!==Object.prototype.toString.call(this.getTravelTimes())?this.getErrors().push("Travel times have to be an array!"):_.reject(this.getTravelTimes(),function(e){return"number"==typeof e}).length>0&&this.getErrors().push("Travel times contain non number entries: "+this.getTravelTimes())),0==this.errors.length},this.isValidRouteServiceOptions=function(){return this.isValidPolygonServiceOptions(!0),"[object Array]"===Object.prototype.toString.call(this.getTargets())?0==this.getTargets().length?this.getErrors().push("Sources do not contain any points!"):_.each(this.getTargets(),function(e){_.has(e,"lat")||"function"==typeof e.getLatLng||this.getErrors().push("Targets contains target with undefined latitude!"),_.has(e,"lon")||_.has(e,"lng")||"function"==typeof e.getLatLng||this.getErrors().push("Targets contains target with undefined longitude!")}):this.getErrors().push("Targets are not of type array!"),_.contains(["travelTime","compact","detailed"],this.getPathSerializer())||this.getErrors().push("Path serializer not supported: "+this.getPathSerializer()),0==this.errors.length},this.isValidTimeServiceOptions=function(){return this.isValidRouteServiceOptions(),_.contains(["travelTime","compact","detailed"],this.getPathSerializer())||this.getErrors().push("Path serializer not supported: "+this.getPathSerializer()),0==this.errors.length},this.getErrors=function(){return this.errors},this.getSources=function(){return this.sources},this.addSource=function(e){this.sources.push(e)},this.addTarget=function(e){this.targets.push(e)},this.getTargets=function(){return this.targets},this.getBikeSpeed=function(){return this.bikeSpeed},this.getBikeUphill=function(){return this.bikeUphill},this.getBikeDownhill=function(){return this.bikeDownhill},this.getWalkSpeed=function(){return this.walkSpeed},this.getWalkUphill=function(){return this.walkUphill},this.getWalkDownhill=function(){return this.walkDownhill},this.getTravelTimes=function(){return this.travelTimes},this.getTravelType=function(){return this.travelType},this.getTime=function(){return this.time},this.getDate=function(){return this.date},this.getWaitControl=function(){return this.waitControl},this.getService=function(){return this.service},this.getPathSerializer=function(){return this.pathSerializer},this.getMaxRoutingTime=function(){return this.maxRoutingTime},this.getIntersectionMode=function(){return this.intersectionMode},this.setIntersectionMode=function(e){this.intersectionMode=e},this.setMaxRoutingTime=function(e){this.maxRoutingTime=e},this.setPathSerializer=function(e){this.pathSerializer=e},this.setService=function(e){this.service=e},this.setMinPolygonHoleSize=function(e){this.minPolygonHoleSize=e},this.getMinPolygonHoleSize=function(){return this.minPolygonHoleSize},this.setSources=function(e){this.sources=e},this.setTargets=function(e){this.targets=e},this.setBikeSpeed=function(e){this.bikeSpeed=e},this.setBikeUphill=function(e){this.bikeUphill=e},this.setBikeDownhill=function(e){this.bikeDownhill=e},this.setWalkSpeed=function(e){this.walkSpeed=e},this.setWalkUphill=function(e){this.walkUphill=e},this.setWalkDownhill=function(e){this.walkDownhill=e},this.setTravelTimes=function(e){this.travelTimes=e},this.setTravelType=function(e){this.travelType=e},this.setTime=function(e){this.time=e},this.setDate=function(e){this.date=e},this.setWaitControl=function(e){this.waitControl=e},this.isElevationEnabled=function(){return this.elevationEnabled},this.setElevationEnabled=function(e){this.elevationEnabled=e},this.setRenderWatts=function(e){this.renderWatts=e},this.getRenderWatts=function(){return this.renderWatts},this.setSupportWatts=function(e){this.supportWatts=e},this.getSupportWatts=function(){return this.supportWatts}},a.travelOptions=function(){return new a.TravelOptions},a.PolygonService={cache:{},getTravelTimePolygons:function(e,t,i){e.getWaitControl()&&(e.getWaitControl().show(),e.getWaitControl().updateText(a.config.i18n.getSpan("polygonWait")));var n={};n.sources=[],_.isUndefined(e.isElevationEnabled())||(n.elevation=e.isElevationEnabled()),_.isUndefined(e.getTravelTimes())&&_.isUndefined(e.getIntersectionMode())&&_.isUndefined(e.getRenderWatts())&&_.isUndefined(e.getSupportWatts())||(n.polygon={},_.isUndefined(e.getTravelTimes())||(n.polygon.values=e.getTravelTimes()),_.isUndefined(e.getIntersectionMode())||(n.polygon.intersectionMode=e.getIntersectionMode()),_.isUndefined(e.getRenderWatts())||(n.polygon.renderWatts=e.getRenderWatts()),_.isUndefined(e.getSupportWatts())||(n.polygon.supportWatts=e.getSupportWatts()),_.isUndefined(e.getMinPolygonHoleSize())||(n.polygon.minPolygonHoleSize=e.getMinPolygonHoleSize())),_.each(e.getSources(),function(t){var i={lat:_.has(t,"lat")?t.lat:t.getLatLng().lat,lng:_.has(t,"lon")?t.lon:_.has(t,"lng")?t.lng:t.getLatLng().lng,id:_.has(t,"id")?t.id:"",tm:{}},o=_.has(t,"travelType")?t.travelType:e.getTravelType();i.tm[o]={},"transit"==o&&(i.tm.transit.frame={},_.isUndefined(e.getTime())||(i.tm.transit.frame.time=e.getTime()),_.isUndefined(e.getDate())||(i.tm.transit.frame.date=e.getDate())),"ebike"==o&&(i.tm.ebike={},_.isUndefined(e.getBikeSpeed())||(i.tm.ebike.speed=e.getBikeSpeed()),_.isUndefined(e.getBikeUphill())||(i.tm.ebike.uphill=e.getBikeUphill()),_.isUndefined(e.getBikeDownhill())||(i.tm.ebike.downhill=e.getBikeDownhill())),"rentbike"==o&&(i.tm.rentbike={},_.isUndefined(e.getBikeSpeed())||(i.tm.rentbike.bikespeed=e.getBikeSpeed()),_.isUndefined(e.getBikeUphill())||(i.tm.rentbike.bikeuphill=e.getBikeUphill()),_.isUndefined(e.getBikeDownhill())||(i.tm.rentbike.bikedownhill=e.getBikeDownhill()),_.isUndefined(e.getWalkSpeed())||(i.tm.rentbike.walkspeed=e.getWalkSpeed()),_.isUndefined(e.getWalkUphill())||(i.tm.rentbike.walkuphill=e.getWalkUphill()),_.isUndefined(e.getWalkDownhill())||(i.tm.rentbike.walkdownhill=e.getWalkDownhill())),"rentandreturnbike"==o&&(i.tm.rentandreturnbike={},_.isUndefined(e.getBikeSpeed())||(i.tm.rentandreturnbike.bikespeed=e.getBikeSpeed()),_.isUndefined(e.getBikeUphill())||(i.tm.rentandreturnbike.bikeuphill=e.getBikeUphill()),_.isUndefined(e.getBikeDownhill())||(i.tm.rentandreturnbike.bikedownhill=e.getBikeDownhill()),_.isUndefined(e.getWalkSpeed())||(i.tm.rentandreturnbike.walkspeed=e.getWalkSpeed()),_.isUndefined(e.getWalkUphill())||(i.tm.rentandreturnbike.walkuphill=e.getWalkUphill()),_.isUndefined(e.getWalkDownhill())||(i.tm.rentandreturnbike.walkdownhill=e.getWalkDownhill())),"bike"==o&&(i.tm.bike={},_.isUndefined(e.getBikeSpeed())||(i.tm.bike.speed=e.getBikeSpeed()),_.isUndefined(e.getBikeUphill())||(i.tm.bike.uphill=e.getBikeUphill()),_.isUndefined(e.getBikeDownhill())||(i.tm.bike.downhill=e.getBikeDownhill())),"walk"==o&&(i.tm.walk={},_.isUndefined(e.getWalkSpeed())||(i.tm.walk.speed=e.getWalkSpeed()),_.isUndefined(e.getWalkUphill())||(i.tm.walk.uphill=e.getWalkUphill()),_.isUndefined(e.getWalkDownhill())||(i.tm.walk.downhill=e.getWalkDownhill())),n.sources.push(i)}),_.has(a.PolygonService.cache,JSON.stringify(n))?(e.getWaitControl()&&e.getWaitControl().hide(),t(a.Util.parsePolygons(a.PolygonService.cache[JSON.stringify(n)]))):$.ajax({url:a.config.serviceUrl+a.config.serviceVersion+"/polygon?cfg="+encodeURIComponent(JSON.stringify(n))+"&cb=?&key="+a.config.serviceKey,timeout:a.config.requestTimeout,dataType:"json",success:function(o){e.getWaitControl()&&e.getWaitControl().hide(),_.has(o,"data")?"ok"==o.code?(a.PolygonService.cache[JSON.stringify(n)]=o.data,t(a.Util.parsePolygons(o.data))):_.isFunction(i)&&i(o.code,o.message):(a.PolygonService.cache[JSON.stringify(n)]=o,t(a.Util.parsePolygons(o)))},error:function(){e.getWaitControl()&&e.getWaitControl().hide(),_.isFunction(i)&&i("service-not-available","The travel time polygon service is currently not available, please try again later.")}})}},a.RouteService={cache:{},getRoutes:function(e,t,i){e.getWaitControl()&&(e.getWaitControl().show(),e.getWaitControl().updateText(a.config.i18n.getSpan("routeWait")));var n={sources:[],targets:[],pathSerializer:e.getPathSerializer(),elevation:e.isElevationEnabled()};_.each(e.getSources(),function(t){var i={lat:_.has(t,"lat")?t.lat:t.getLatLng().lat,lng:_.has(t,"lon")?t.lon:_.has(t,"lng")?t.lng:t.getLatLng().lng,id:_.has(t,"id")?t.id:"",tm:{}},o=_.has(t,"travelType")?t.travelType:e.getTravelType();i.tm[o]={},"transit"==o&&(i.tm.transit.frame={},_.isUndefined(e.getTime())||(i.tm.transit.frame.time=e.getTime()),_.isUndefined(e.getDate())||(i.tm.transit.frame.date=e.getDate())),"ebike"==o&&(i.tm.ebike={},_.isUndefined(e.getBikeSpeed())||(i.tm.ebike.speed=e.getBikeSpeed()),_.isUndefined(e.getBikeUphill())||(i.tm.ebike.uphill=e.getBikeUphill()),_.isUndefined(e.getBikeDownhill())||(i.tm.ebike.downhill=e.getBikeDownhill())),"rentbike"==o&&(i.tm.rentbike={},_.isUndefined(e.getBikeSpeed())||(i.tm.rentbike.bikespeed=e.getBikeSpeed()),_.isUndefined(e.getBikeUphill())||(i.tm.rentbike.bikeuphill=e.getBikeUphill()),_.isUndefined(e.getBikeDownhill())||(i.tm.rentbike.bikedownhill=e.getBikeDownhill()),_.isUndefined(e.getWalkSpeed())||(i.tm.rentbike.walkspeed=e.getWalkSpeed()),_.isUndefined(e.getWalkUphill())||(i.tm.rentbike.walkuphill=e.getWalkUphill()),_.isUndefined(e.getWalkDownhill())||(i.tm.rentbike.walkdownhill=e.getWalkDownhill())),"rentandreturnbike"==o&&(i.tm.rentandreturnbike={},_.isUndefined(e.getBikeSpeed())||(i.tm.rentandreturnbike.bikespeed=e.getBikeSpeed()),_.isUndefined(e.getBikeUphill())||(i.tm.rentandreturnbike.bikeuphill=e.getBikeUphill()),_.isUndefined(e.getBikeDownhill())||(i.tm.rentandreturnbike.bikedownhill=e.getBikeDownhill()),_.isUndefined(e.getWalkSpeed())||(i.tm.rentandreturnbike.walkspeed=e.getWalkSpeed()),_.isUndefined(e.getWalkUphill())||(i.tm.rentandreturnbike.walkuphill=e.getWalkUphill()),_.isUndefined(e.getWalkDownhill())||(i.tm.rentandreturnbike.walkdownhill=e.getWalkDownhill())),"bike"==o&&(i.tm.bike={},_.isUndefined(e.getBikeSpeed())||(i.tm.bike.speed=e.getBikeSpeed()),_.isUndefined(e.getBikeUphill())||(i.tm.bike.uphill=e.getBikeUphill()),_.isUndefined(e.getBikeDownhill())||(i.tm.bike.downhill=e.getBikeDownhill())),"walk"==o&&(i.tm.walk={},_.isUndefined(e.getWalkSpeed())||(i.tm.walk.speed=e.getWalkSpeed()),_.isUndefined(e.getWalkUphill())||(i.tm.walk.uphill=e.getWalkUphill()),_.isUndefined(e.getWalkDownhill())||(i.tm.walk.downhill=e.getWalkDownhill())),n.sources.push(i)}),n.targets=[],_.each(e.getTargets(),function(e){n.targets.push({lat:_.has(e,"lat")?e.lat:e.getLatLng().lat,lng:_.has(e,"lon")?e.lon:_.has(e,"lng")?e.lng:e.getLatLng().lng,id:_.has(e,"id")?e.id:""})}),_.has(a.RouteService.cache,JSON.stringify(n))?(e.getWaitControl()&&e.getWaitControl().hide(),t(a.Util.parseRoutes(a.RouteService.cache[JSON.stringify(n)]))):$.ajax({url:a.config.serviceUrl+a.config.serviceVersion+"/route?cfg="+encodeURIComponent(JSON.stringify(n))+"&cb=?&key="+a.config.serviceKey,timeout:a.config.requestTimeout,dataType:"json",success:function(o){e.getWaitControl()&&e.getWaitControl().hide(),_.has(o,"data")?"ok"==o.code?(a.RouteService.cache[JSON.stringify(n)]=o.data,t(a.Util.parseRoutes(o.data))):_.isFunction(i)&&i(o.code,o.message):(a.RouteService.cache[JSON.stringify(n)]=o,t(a.Util.parseRoutes(o)))},error:function(){e.getWaitControl()&&e.getWaitControl().hide(),_.isFunction(i)&&i("service-not-available","The routing service is currently not available, please try again later.")}})}},a.TimeService={cache:{},getRouteTime:function(e,t,i){e.getWaitControl()&&(e.getWaitControl().show(),e.getWaitControl().updateText(a.config.i18n.getSpan("timeWait")));var n={sources:[],targets:[],pathSerializer:e.getPathSerializer(),maxRoutingTime:e.getMaxRoutingTime()};_.isUndefined(e.isElevationEnabled())||(n.elevation=e.isElevationEnabled()),_.isUndefined(e.getTravelTimes())&&_.isUndefined(e.getIntersectionMode())&&_.isUndefined(e.getRenderWatts())&&_.isUndefined(e.getSupportWatts())||(n.polygon={},_.isUndefined(e.getTravelTimes())||(n.polygon.values=e.getTravelTimes()),_.isUndefined(e.getIntersectionMode())||(n.polygon.intersectionMode=e.getIntersectionMode()),_.isUndefined(e.getRenderWatts())||(n.polygon.renderWatts=e.getRenderWatts()),_.isUndefined(e.getSupportWatts())||(n.polygon.supportWatts=e.getSupportWatts()),_.isUndefined(e.getMinPolygonHoleSize())||(n.polygon.minPolygonHoleSize=e.getMinPolygonHoleSize())),_.each(e.getSources(),function(t){var i={lat:_.has(t,"lat")?t.lat:t.getLatLng().lat,lng:_.has(t,"lon")?t.lon:_.has(t,"lng")?t.lng:t.getLatLng().lng,id:_.has(t,"id")?t.id:"",tm:{}},o=_.has(t,"travelType")?t.travelType:e.getTravelType();i.tm[o]={},"transit"==o&&(i.tm.transit.frame={},_.isUndefined(e.getTime())||(i.tm.transit.frame.time=e.getTime()),_.isUndefined(e.getDate())||(i.tm.transit.frame.date=e.getDate())),"ebike"==o&&(i.tm.ebike={},_.isUndefined(e.getBikeSpeed())||(i.tm.ebike.speed=e.getBikeSpeed()),_.isUndefined(e.getBikeUphill())||(i.tm.ebike.uphill=e.getBikeUphill()),_.isUndefined(e.getBikeDownhill())||(i.tm.ebike.downhill=e.getBikeDownhill())),"rentbike"==o&&(i.tm.rentbike={},_.isUndefined(e.getBikeSpeed())||(i.tm.rentbike.bikespeed=e.getBikeSpeed()),_.isUndefined(e.getBikeUphill())||(i.tm.rentbike.bikeuphill=e.getBikeUphill()),_.isUndefined(e.getBikeDownhill())||(i.tm.rentbike.bikedownhill=e.getBikeDownhill()),_.isUndefined(e.getWalkSpeed())||(i.tm.rentbike.walkspeed=e.getWalkSpeed()),_.isUndefined(e.getWalkUphill())||(i.tm.rentbike.walkuphill=e.getWalkUphill()),_.isUndefined(e.getWalkDownhill())||(i.tm.rentbike.walkdownhill=e.getWalkDownhill())),"rentandreturnbike"==o&&(i.tm.rentandreturnbike={},_.isUndefined(e.getBikeSpeed())||(i.tm.rentandreturnbike.bikespeed=e.getBikeSpeed()),_.isUndefined(e.getBikeUphill())||(i.tm.rentandreturnbike.bikeuphill=e.getBikeUphill()),_.isUndefined(e.getBikeDownhill())||(i.tm.rentandreturnbike.bikedownhill=e.getBikeDownhill()),_.isUndefined(e.getWalkSpeed())||(i.tm.rentandreturnbike.walkspeed=e.getWalkSpeed()),_.isUndefined(e.getWalkUphill())||(i.tm.rentandreturnbike.walkuphill=e.getWalkUphill()),_.isUndefined(e.getWalkDownhill())||(i.tm.rentandreturnbike.walkdownhill=e.getWalkDownhill())),"bike"==o&&(i.tm.bike={},_.isUndefined(e.getBikeSpeed())||(i.tm.bike.speed=e.getBikeSpeed()),_.isUndefined(e.getBikeUphill())||(i.tm.bike.uphill=e.getBikeUphill()),_.isUndefined(e.getBikeDownhill())||(i.tm.bike.downhill=e.getBikeDownhill())),"walk"==o&&(i.tm.walk={},_.isUndefined(e.getWalkSpeed())||(i.tm.walk.speed=e.getWalkSpeed()),_.isUndefined(e.getWalkUphill())||(i.tm.walk.uphill=e.getWalkUphill()),_.isUndefined(e.getWalkDownhill())||(i.tm.walk.downhill=e.getWalkDownhill())),n.sources.push(i)}),_.each(e.getTargets(),function(e){n.targets.push({lat:_.has(e,"lat")?e.lat:e.getLatLng().lat,lng:_.has(e,"lon")?e.lon:_.has(e,"lng")?e.lng:e.getLatLng().lng,id:_.has(e,"id")?e.id:""})}),_.has(a.TimeService.cache,JSON.stringify(n))?(e.getWaitControl()&&e.getWaitControl().hide(),t(a.TimeService.cache[JSON.stringify(n)])):$.ajax({url:a.config.serviceUrl+a.config.serviceVersion+"/time?key="+a.config.serviceKey,type:"POST",data:JSON.stringify(n),contentType:"application/json",timeout:a.config.requestTimeout,dataType:"json",success:function(o){e.getWaitControl()&&e.getWaitControl().hide(),_.has(o,"data")?"ok"==o.code?(a.TimeService.cache[JSON.stringify(n)]=o.data,t(o.data)):_.isFunction(i)&&i(o.code,o.message):(a.TimeService.cache[JSON.stringify(n)]=o,t(o))},error:function(){e.getWaitControl()&&e.getWaitControl().hide(),_.isFunction(i)&&i("service-not-available","The time service is currently not available, please try again later.")}})}},a.OsmService={cache:{},getPoisInBoundingBox:function(e,t,i,n,o){i&&(i.show(),i.updateText(a.config.i18n.getSpan("osmWait")));var r=$.param({tags:t},!0);"undefined"!=typeof e&&(r.northEast=e._northEast.lng+"|"+e._northEast.lat,r.southWest=e._southWest.lng+"|"+e._southWest.lat),_.has(a.OsmService.cache,r)?(i&&i.hide(),n(a.OsmService.cache[r])):$.ajax({url:a.config.osmServiceUrl+"pois/search?callback=?&"+r,timeout:a.config.requestTimeout,dataType:"json",success:function(e){i&&i.hide(),n(e)},error:function(){i&&i.hide(),_.isFunction(o)&&o("service-not-available","The travel time polygon service is currently not available, please try again later.")}})}},a.PopulationService={cache:{},getPopulationStatistics:function(e,t,i,n){e.getWaitControl()&&(e.getWaitControl().show(),e.getWaitControl().updateText(a.config.i18n.getSpan("populationWait")));var o={};o.sources=[],"undefined"!=typeof e.isElevationEnabled()&&(o.elevation=e.isElevationEnabled()),("undefined"!=typeof e.getTravelTimes()||"undefined"!=typeof e.getIntersectionMode()||"undefined"!=typeof e.getRenderWatts()||"undefined"!=typeof e.getSupportWatts())&&(o.polygon={},"undefined"!=typeof e.getTravelTimes()&&(o.polygon.values=e.getTravelTimes()),"undefined"!=typeof e.getIntersectionMode()&&(o.polygon.intersectionMode=e.getIntersectionMode()),"undefined"!=typeof e.getRenderWatts()&&(o.polygon.renderWatts=e.getRenderWatts()),"undefined"!=typeof e.getSupportWatts()&&(o.polygon.supportWatts=e.getSupportWatts())),_.each(e.getSources(),function(t){var i={lat:_.has(t,"lat")?t.lat:t.getLatLng().lat,lng:_.has(t,"lon")?t.lon:_.has(t,"lng")?t.lng:t.getLatLng().lng,id:_.has(t,"id")?t.id:t.lat+";"+t.lng,tm:{}},n=_.has(t,"travelType")?t.travelType:e.getTravelType();i.tm[n]={},"transit"==n&&(i.tm.transit.frame={},_.isUndefined(e.getTime())||(i.tm.transit.frame.time=e.getTime()),_.isUndefined(e.getDate())||(i.tm.transit.frame.date=e.getDate())),"ebike"==n&&(i.tm.ebike={},_.isUndefined(e.getBikeSpeed())||(i.tm.ebike.speed=e.getBikeSpeed()),_.isUndefined(e.getBikeUphill())||(i.tm.ebike.uphill=e.getBikeUphill()),_.isUndefined(e.getBikeDownhill())||(i.tm.ebike.downhill=e.getBikeDownhill())),"rentbike"==n&&(i.tm.rentbike={},_.isUndefined(e.getBikeSpeed())||(i.tm.rentbike.bikespeed=e.getBikeSpeed()),_.isUndefined(e.getBikeUphill())||(i.tm.rentbike.bikeuphill=e.getBikeUphill()),_.isUndefined(e.getBikeDownhill())||(i.tm.rentbike.bikedownhill=e.getBikeDownhill()),_.isUndefined(e.getWalkSpeed())||(i.tm.rentbike.walkspeed=e.getWalkSpeed()),_.isUndefined(e.getWalkUphill())||(i.tm.rentbike.walkuphill=e.getWalkUphill()),_.isUndefined(e.getWalkDownhill())||(i.tm.rentbike.walkdownhill=e.getWalkDownhill())),"rentandreturnbike"==n&&(i.tm.rentandreturnbike={},_.isUndefined(e.getBikeSpeed())||(i.tm.rentandreturnbike.bikespeed=e.getBikeSpeed()),_.isUndefined(e.getBikeUphill())||(i.tm.rentandreturnbike.bikeuphill=e.getBikeUphill()),_.isUndefined(e.getBikeDownhill())||(i.tm.rentandreturnbike.bikedownhill=e.getBikeDownhill()),_.isUndefined(e.getWalkSpeed())||(i.tm.rentandreturnbike.walkspeed=e.getWalkSpeed()),_.isUndefined(e.getWalkUphill())||(i.tm.rentandreturnbike.walkuphill=e.getWalkUphill()),_.isUndefined(e.getWalkDownhill())||(i.tm.rentandreturnbike.walkdownhill=e.getWalkDownhill())),"bike"==n&&(i.tm.bike={},_.isUndefined(e.getBikeSpeed())||(i.tm.bike.speed=e.getBikeSpeed()),_.isUndefined(e.getBikeUphill())||(i.tm.bike.uphill=e.getBikeUphill()),_.isUndefined(e.getBikeDownhill())||(i.tm.bike.downhill=e.getBikeDownhill())),"walk"==n&&(i.tm.walk={},_.isUndefined(e.getWalkSpeed())||(i.tm.walk.speed=e.getWalkSpeed()),_.isUndefined(e.getWalkUphill())||(i.tm.walk.uphill=e.getWalkUphill()),_.isUndefined(e.getWalkDownhill())||(i.tm.walk.downhill=e.getWalkDownhill())),o.sources.push(i)});var r=[];_.each(t,function(e){r.push("statistics="+e)}),_.has(a.PopulationService.cache,JSON.stringify(o)+r.join("&"))?(e.getWaitControl()&&e.getWaitControl().hide(),i(a.PopulationService.cache[JSON.stringify(o)+r.join("&")])):$.ajax({url:a.config.serviceUrl+a.config.serviceVersion+"/population?cfg="+encodeURIComponent(JSON.stringify(o))+"&cb=?&key="+a.config.serviceKey+"&"+r.join("&"),timeout:a.config.requestTimeout,dataType:"json",success:function(t){e.getWaitControl()&&e.getWaitControl().hide(),_.has(t,"data")?"ok"==t.code?(a.PopulationService.cache[JSON.stringify(o)+r.join("&")]=t.data,i(t.data)):_.isFunction(n)&&n(t.code,t.message):(a.PopulationService.cache[JSON.stringify(o)+r.join("&")]=t,i(a.Util.parsePolygons(t)))
},error:function(){e.getWaitControl()&&e.getWaitControl().hide(),_.isFunction(n)&&n("service-not-available","The population service is currently not available, please try again later.")}})}},a.placeAutoCompleteControl=function(e){return new a.PlaceAutoCompleteControl(e)},a.PlaceAutoCompleteControl=L.Control.extend({initialize:function(e){this.options=JSON.parse(JSON.stringify(a.config.defaultPlaceAutoCompleteOptions)),"undefined"!=typeof e&&(_.has(e,"position")&&(this.options.position=e.position),_.has(e,"label")&&(this.options.label=e.label),_.has(e,"country")&&(this.options.country=e.country),_.has(e,"reset")&&(this.options.reset=e.reset),_.has(e,"reverse")&&(this.options.reverse=e.reverse),_.has(e,"placeholder")&&(this.options.placeholder=e.placeholder),_.has(e,"width")&&(this.options.width=e.width),_.has(e,"maxRows")&&(this.options.maxRows=e.maxRows),_.has(e,"showOnStartup")&&(this.options.showOnStartup=e.showOnStartup),_.has(e,"image")&&(this.options.image=e.image),_.has(e,"index")&&(this.options.index=e.index),_.has(e,"options")&&(this.options.options=e.options,this.options.travelType=_.has(this.options.options,"init")?this.options.options.init:"walk"))},toggleOptions:function(e){var t=this;"undefined"==typeof e?$("#"+t.options.id+"-options").slideToggle():$(e).find("#"+t.options.id+"-options").slideToggle()},onAdd:function(e){var t=this,i=a.config.i18n,n="",o=L.DomUtil.create("div",t._container);t.options.map=e,t.options.id=$(e._container).attr("id")+a.Util.generateId(10),e.on("resize",t.onResize.bind(t));var r=t.options.width,s='style="width:'+r+'px;"';t.options.input='<div class="input-group autocomplete r360-box-shadow" '+s+'>                 <input id="autocomplete-'+t.options.id+'" style="color: black;width:'+r+'"                 type="text" class="form-control r360-autocomplete" placeholder="'+t.options.placeholder+'" onclick="this.select()">',t.options.image&&(t.options.input+='<span id="'+t.options.id+'-image" class="input-group-addon btn-autocomplete-marker">                     <img style="height:22px;" src="'+t.options.image+'">                  </span>');var l=[];return t.options.input+='<span id="'+t.options.id+'-options-button" class="input-group-btn travel-type-buttons" '+(t.options.options?"":'style="display: none;"')+'>                     <button id="'+t.options.id+'-options-btn" class="btn btn-autocomplete" type="button" title="'+i.get("settings")+'"><i class="fa fa-cog fa-fw"></i></button>                 </span>',l.push('<div id="'+t.options.id+'-options" class="text-center r360-box-shadow" style="color: black;width:'+r+"; display: "+(this.options.showOnStartup?"block":"none")+';">'),l.push('  <div class="btn-group text-center">'),t.options.options&&t.options.options.walk&&l.push('<button type="button" class="btn btn-default travel-type-button '+("walk"==this.options.travelType?"active":"")+'" travel-type="walk"><span class="fa fa-male travel-type-icon"></span> <span lang="en">Walk</span><span lang="no">Gå</span><span lang="de">zu Fuß</span></button>'),t.options.options&&t.options.options.bike&&l.push('<button type="button" class="btn btn-default travel-type-button '+("bike"==this.options.travelType?"active":"")+'" travel-type="bike"><span class="fa fa-bicycle travel-type-icon"></span> <span lang="en">Bike</span><span lang="no">Sykle</span><span lang="de">Fahrrad</span></button>'),t.options.options&&t.options.options.rentbike&&l.push('<button type="button" class="btn btn-default travel-type-button '+("rentbike"==this.options.travelType?"active":"")+'" travel-type="rentbike">                             <span class="fa fa-bicycle travel-type-icon"></span> <span lang="en">Hire Bike</span><span lang="no">Bysykkel</span><span lang="de">Leihfahrrad</span>                        </button>'),t.options.options&&t.options.options.rentandreturnbike&&l.push('<button type="button" class="btn btn-default travel-type-button '+("rentandreturnbike"==this.options.travelType?"active":"")+'" travel-type="rentandreturnbike">                             <span class="fa fa-bicycle travel-type-icon"></span> <span lang="en">Hire & Return Bike</span><span lang="no">Bysykkel</span><span lang="de">Leihfahrrad</span>                        </button>'),t.options.options&&t.options.options.ebike&&l.push('<button type="button" class="btn btn-default travel-type-button '+("ebike"==this.options.travelType?"active":"")+'" travel-type="ebike"><span class="fa fa-bicycle travel-type-icon"></span> <span lang="en">E-Bike</span><span lang="no">Elsykkel</span><span lang="de">E-Fahrrad</span></button>'),t.options.options&&t.options.options.transit&&l.push('<button type="button" class="btn btn-default travel-type-button '+("transit"==this.options.travelType?"active":"")+'" travel-type="transit"><span class="fa fa-bus travel-type-icon"></span> <span lang="en">Transit</span><span lang="no">TODO</span><span lang="de">ÖPNV</span></button>'),t.options.options&&t.options.options.car&&l.push('<button type="button" class="btn btn-default travel-type-button '+("car"==this.options.travelType?"active":"")+'" travel-type="car"><span class="fa fa-car"></span> <span lang="en">Car</span><span lang="no">TODO</span><span lang="de">Auto</span></button>'),l.push("  </div>"),l.push("</div>"),t.options.input+='<span id="'+t.options.id+'-reverse" '+(t.options.reverse?"":'style="display: none;"')+'" class="input-group-btn">                     <button id="'+t.options.id+'-reverse-button" class="btn btn-autocomplete" type="button" title="'+i.get("reverse")+'"><i class="fa fa-arrows-v fa-fw"></i></button>                 </span>',t.options.input+='<span id="'+t.options.id+'-reset" '+(t.options.reset?"":'style="display: none;"')+'" class="input-group-btn">                     <button id="'+t.options.id+'-reset-button" class="btn btn-autocomplete" type="button" title="'+i.get("reset")+'"><i class="fa fa-times fa-fw"></i></button>                 </span>',t.options.input+="</div>",t.options.options&&(t.options.input+=l.join("")),$(o).append(t.options.input),$(o).find("#"+t.options.id+"-reset").click(function(){t.options.onReset()}),$(o).find("#"+t.options.id+"-reverse").click(function(){t.options.onReverse()}),$(o).find("#"+t.options.id+"-options-button").click(function(){$("#"+t.options.id+"-options").slideToggle()}),$(o).find(".travel-type-button").click(function(){$(o).find(".travel-type-button").removeClass("active"),$(this).addClass("active"),setTimeout(function(){$("#"+t.options.id+"-options").slideToggle()},300),t.options.travelType=$(this).attr("travel-type"),t.options.onTravelTypeChange()}),L.DomEvent.disableClickPropagation(o),_.has(t.options,"country")&&(n+=" AND country:"+t.options.country),$(o).find("#autocomplete-"+t.options.id).autocomplete({source:function(e,i){t.source=this;for(var o=e.term.split(" "),a=new Array,r="",s="",l=0;l<o.length;l++)-1!=o[l].search(".*[0-9].*")?a.push(o[l]):r+=o[l]+" ";if(a.length>0){s+=" OR ";for(var p=0;p<a.length;p++){var d="(postcode : "+a[p]+" OR housenumber : "+a[p]+" OR street : "+a[p]+") ";s+=d}}$.ajax({url:t.options.serviceUrl,dataType:"jsonp",jsonp:"json.wrf",async:!1,data:{wt:"json",indent:!0,rows:t.options.maxRows,qt:"en",q:"("+r+s+")"+n},success:function(n){var o=new Array;i($.map(n.response.docs,function(i){if("boundary"!=i.osm_key){var n=i.coordinate.split(","),a={},r=[],s=[];if(a.name=i.name,a.city=i.city,a.street=i.street,a.housenumber=i.housenumber,a.country=i.country,a.postalCode=i.postcode,a.name&&r.push(a.name),a.city&&r.push(a.city),a.street&&s.push(a.street),a.housenumber&&s.push(a.housenumber),a.postalCode&&s.push(a.postalCode),a.city&&s.push(a.city),!_.has(t.options,"country")&&a.country&&s.push(a.country),!_.contains(o,r.join()+s.join()))return o.push(r.join()+s.join()),{label:r.join(", "),value:r.join(", "),firstRow:r.join(", "),secondRow:s.join(" "),term:e.term,index:t.options.index,latlng:new L.LatLng(n[0],n[1])}}}))}})},minLength:2,select:function(e,i){t.options.value=i.item,t.options.onSelect(i.item)}}).data("ui-autocomplete")._renderItem=function(e,t){function i(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}var n=t.term?t.firstRow.replace(new RegExp(i(t.term),"gi"),"<strong>$&</strong>"):t.firstRow,o=t.term?t.secondRow.replace(new RegExp(i(t.term),"gi"),"<strong>$&</strong>"):t.secondRow,a="<a><span class='address-row1'>"+n+"</span><br/><span class='address-row2'>  "+o+"</span></a>";return $("<li>").append(a).appendTo(e)},this.onResize(),o},onSelect:function(e){this.options.onSelect=e},onReset:function(e){this.options.onReset=e},onReverse:function(e){this.options.onReverse=e},onTravelTypeChange:function(e){this.options.onTravelTypeChange=e},updateI18n:function(e){var t=this;$("#autocomplete-"+t.options.id).attr("placeholder",a.config.i18n.get(e?"placeholderSrc":"placeholderTrg")),$("#"+t.options.id+"-reverse-button").attr("title",a.config.i18n.get("reverse")),$("#"+t.options.id+"-reset-button").attr("title",a.config.i18n.get("reset")),$("#"+t.options.id+"-options-btn").attr("title",a.config.i18n.get("settings"))},reset:function(){this.options.value={},this.setFieldValue("")},update:function(e,t){this.setLatLng(e),this.setFieldValue(t)},setLatLng:function(e){this.options.value.latlng=e},setFieldValue:function(e){var t=this;$("#autocomplete-"+t.options.id).val(e)},getFieldValue:function(){var e=this;return $("#autocomplete-"+e.options.id).val()},getTravelType:function(){return this.options.travelType},setValue:function(e){this.options.value=e},getValue:function(){return this.options.value},getIndex:function(){return this.options.index},onResize:function(){var e=this;$(e.options.input).css(this.options.map.getSize().x<550?{width:"45px"}:{width:""})}}),a.TravelStartDateControl=L.Control.extend({options:{position:"topright",dateFormat:"yy-mm-dd",minDate:0},initialize:function(e){L.Util.setOptions(this,e)},onChange:function(e){this.options.onChange=e},onAdd:function(e){var t=this;t.options.map=e;var i=L.DomUtil.create("div","startDatePicker",this._container);t.datepicker=$("<div/>"),$(i).append(t.datepicker);var n={onSelect:function(){t.options.onChange(t.getValue())},firstDay:1},o=a.config.i18n;return"en"!=o.language&&(n.monthNames=o.monthNames[o.language],n.dayNames=o.dayNames[o.language],n.dayNamesMin=o.dayNamesMin[o.language]),$(t.datepicker).datepicker(n),L.DomEvent.disableClickPropagation(i),i},getValue:function(){var e=this,t=$(e.datepicker).datepicker({dateFormat:"dd-mm-yy"}).val(),i=t.split("/"),n=i[2]+""+i[0]+i[1];return n}}),a.travelStartDateControl=function(){return new a.TravelStartDateControl},a.TravelStartTimeControl=L.Control.extend({options:{position:"topright",range:!1,min:0,max:86400,step:600,initValue:28800,value:0},initialize:function(e){this.options.value=a.Util.getHoursAndMinutesInSeconds(),L.Util.setOptions(this,e)},onSlideStop:function(e){this.options.slideStop=e},minToString:function(e){e/=60;var t=Math.floor(e/60),i=e-60*t;return t>24&&(t-=24),10>t&&(t="0"+t),10>i&&(i="0"+i),0==i&&(i="00"),t+":"+i},onAdd:function(e){var t=this;t.options.map=e,t.options.mapId=$(e._container).attr("id"),e.on("resize",this.onResize.bind(this));var i=L.DomUtil.create("div","startTimeSlider",this._container);return t.miBox=$("<div/>",{"class":"mi-box"}),t.startTimeInfo=$("<div/>"),t.label=$("<span/>"),t.slider=$("<div/>"),$(i).append(t.miBox.append(t.startTimeInfo.append(t.label)).append(t.slider)),$(t.label).text(a.config.i18n.get("departure")+": "+t.minToString(this.options.value)+" "+a.Util.getTimeFormat(t.options.value)),$(t.slider).slider({range:t.options.range,value:t.options.value,min:t.options.min,max:t.options.max,step:t.options.step,slide:function(e,i){$(t.label).text(a.config.i18n.get("departure")+": "+t.minToString(i.value)+" "+a.Util.getTimeFormat(i.value)),t.options.value=i.value},stop:function(e,i){t.options.slideStop(i.value)}}),this.onResize(),L.DomEvent.disableClickPropagation(i),i},onResize:function(){this.options.map.getSize().x<550?(this.removeAndAddClass(this.miBox,"leaflet-traveltime-slider-container-max","leaflet-traveltime-slider-container-min"),this.removeAndAddClass(this.startTimeInfo,"travel-time-info-max","travel-time-info-min"),this.removeAndAddClass(this.slider,"leaflet-traveltime-slider-max","leaflet-traveltime-slider-min")):(this.removeAndAddClass(this.miBox,"leaflet-traveltime-slider-container-min","leaflet-traveltime-slider-container-max"),this.removeAndAddClass(this.startTimeInfo,"travel-time-info-min","travel-time-info-max"),this.removeAndAddClass(this.slider,"leaflet-traveltime-slider-min","leaflet-traveltime-slider-max"))},removeAndAddClass:function(e,t,i){$(e).addClass(i),$(e).removeClass(t)},getValue:function(){return this.options.value}}),a.travelStartTimeControl=function(){return new a.TravelStartTimeControl},a.TravelTimeControl=L.Control.extend({initialize:function(e){this.options=JSON.parse(JSON.stringify(a.config.defaultTravelTimeControlOptions)),"undefined"!=typeof e&&(_.has(e,"position")&&(this.options.position=e.position),_.has(e,"unit")&&(this.options.unit=e.unit),_.has(e,"initValue")&&(this.options.initValue=e.initValue),_.has(e,"label")&&(this.options.label=e.label),_.has(e,"travelTimes")&&(this.options.travelTimes=e.travelTimes),_.has(e,"icon")&&(this.options.icon=e.icon)),this.options.maxValue=_.max(this.options.travelTimes,function(e){return e.time}).time/60,this.options.step=(this.options.travelTimes[1].time-this.options.travelTimes[0].time)/60},onAdd:function(e){var t=this;this.options.map=e,e.on("resize",this.onResize.bind(this));for(var i="",n=100/this.options.travelTimes.length,o=0;o<this.options.travelTimes.length;o++)0==o?i+='<div style="position: absolute; top: 0; bottom: 0; left: '+o*n+"%; right: "+(100-(o+1)*n)+"%; background-color: "+this.options.travelTimes[o].color+'; -moz-border-top-left-radius: 8px;-webkit-border-radius-topleft: 8px; border-top-left-radius: 8px; -moz-border-bottom-left-radius: 8px;-webkit-border-radius-bottomleft: 8px; border-bottom-left-radius: 8px;"></div>':o<this.options.travelTimes.length-1?i+='<div style="position: absolute; top: 0; bottom: 0; left: '+o*n+"%; right: "+(100-(o+1)*n)+"%; background-color: "+this.options.travelTimes[o].color+';"></div>':o==this.options.travelTimes.length-1&&(i+='<div style="position: absolute; top: 0; bottom: 0; left: '+o*n+"%; right: "+(100-(o+1)*n)+"%; background-color: "+this.options.travelTimes[o].color+'; -moz-border-top-right-radius: 8px;-webkit-border-radius-topright: 8px; border-top-right-radius: 8px; -moz-border-bottom-right-radius: 8px;-webkit-border-radius-bottomright: 8px; border-bottom-right-radius: 8px;"></div>');this.options.sliderContainer=L.DomUtil.create("div",this._container),this.options.miBox=$("<div/>",{"class":"mi-box"}),this.options.travelTimeInfo=$("<div/>"),this.options.travelTimeSlider=$("<div/>",{"class":"no-border"}).append(i);var a=$("<div/>",{"class":"ui-slider-handle"});this.options.labelSpan=this.options.label,"undefined"!=this.options.icon&&(this.options.iconHTML=$("<img/>",{src:this.options.icon})),this.options.travelTimeSpan=$("<span/>",{text:this.options.initValue});var r=$("<span/>",{text:this.options.unit});return $(this.options.sliderContainer).append(this.options.miBox),this.options.miBox.append(this.options.travelTimeInfo),this.options.miBox.append(this.options.travelTimeSlider),this.options.travelTimeSlider.append(a),this.options.travelTimeInfo.append(this.options.iconHTML).append(this.options.labelSpan).append(": ").append(this.options.travelTimeSpan).append(r),$(this.options.travelTimeSlider).slider({range:!1,value:t.options.initValue,min:0,max:t.options.maxValue,step:t.options.step,slide:function(e,i){return 0==i.value?!1:void $(t.options.travelTimeSpan).text(i.value)},stop:function(e,i){for(var n=new Array,o=0;o<i.value;o+=t.options.step)n.push(t.options.travelTimes[o/t.options.step]);t.options.onSlideStop(n)}}),this.onResize(),L.DomEvent.disableClickPropagation(this.options.sliderContainer),this.options.sliderContainer},onResize:function(){this.options.map.getSize().x<550?(this.removeAndAddClass(this.options.miBox,"leaflet-traveltime-slider-container-max","leaflet-traveltime-slider-container-min"),this.removeAndAddClass(this.options.travelTimeInfo,"travel-time-info-max","travel-time-info-min"),this.removeAndAddClass(this.options.travelTimeSlider,"leaflet-traveltime-slider-max","leaflet-traveltime-slider-min")):(this.removeAndAddClass(this.options.miBox,"leaflet-traveltime-slider-container-min","leaflet-traveltime-slider-container-max"),this.removeAndAddClass(this.options.travelTimeInfo,"travel-time-info-min","travel-time-info-max"),this.removeAndAddClass(this.options.travelTimeSlider,"leaflet-traveltime-slider-min","leaflet-traveltime-slider-max"))},removeAndAddClass:function(e,t,i){$(e).addClass(i),$(e).removeClass(t)},onSlideStop:function(e){var t=this.options;t.onSlideStop=e},setValue:function(e){$(this.options.travelTimeSlider).slider("value",e),$(this.options.travelTimeSpan).text(e)},getValues:function(){for(var e=this.options,t=new Array,i=0;i<$(this.options.travelTimeSlider).slider("value");i+=e.step)t.push(e.travelTimes[i/e.step].time);return t},getMaxValue:function(){return _.max(this.getValues())}}),a.travelTimeControl=function(e){return new a.TravelTimeControl(e)},a.waitControl=function(e){return new L.Control.WaitControl(e)},L.Control.WaitControl=L.Control.extend({options:{position:"topleft"},initialize:function(e){L.Util.setOptions(this,e)},onAdd:function(e){this.options.map=e,this.options.mapId=$(e._container).attr("id");var t=L.DomUtil.create("div","leaflet-control-wait");return $(t).append('<div id="wait-control-'+this.options.mapId+'" class="mi-box waitControl">                 <i class="fa fa-spinner fa-spin"></i> '+("undefined"!=typeof this.options.text?this.options.text:a.config.i18n.get("wait"))+"            </div>"),t},updateText:function(e){$("#wait-control-"+this.options.mapId).html('<i class="fa fa-spinner fa-spin"></i> '+e),$("span[lang][lang!='"+a.config.i18n.language+"']").hide()},show:function(){$("#wait-control-"+this.options.mapId).show()},hide:function(){$("#wait-control-"+this.options.mapId).hide()}}),a.htmlControl=function(e){return new L.Control.HtmlControl(e)},L.Control.HtmlControl=L.Control.extend({options:{position:"topleft"},initialize:function(e){L.Util.setOptions(this,e)},onAdd:function(e){this.options.id=$(e._container).attr("id")+a.Util.generateId();var t=L.DomUtil.create("div","leaflet-control-html");return $(t).append('<div id="html-control-'+this.options.id+'" class="html-control '+this.options.classes+'"></div>'),$(t).on("mouseover",function(){e.scrollWheelZoom.disable()}),$(t).on("mouseout",function(){e.scrollWheelZoom.enable()}),t},setHtml:function(e){$("#html-control-"+this.options.id).html(e)},show:function(){$("#html-control-"+this.options.id).show()},hide:function(){$("#html-control-"+this.options.id).hide()},toggle:function(){$("#html-control-"+this.options.id).toggle()}}),a.RadioButtonControl=L.Control.extend({initialize:function(e){this.options=JSON.parse(JSON.stringify(a.config.defaultRadioOptions)),"undefined"!=typeof e?("undefined"!=typeof e.position&&(this.options.position=e.position),"undefined"!=typeof e.buttons&&(this.options.buttons=e.buttons),"undefined"!=typeof e.onChange&&(this.options.onChange=e.onChange)):alert("No buttons supplied!")},onAdd:function(e){var t=this;this.options.map=e;var i=L.DomUtil.create("div",this._container);return this.options.input=this.getRadioButtonHTML(),$(i).append(this.options.input),$(this.options.input).buttonset({}).change(function(){t.options.checked=$("input[name='r360_radiobuttongroup_"+t.options.buttonGroupId+"']:checked").attr("key"),t.options.onChange(t.options.checked)}),$(this.options.input).each(function(){$(this).tooltip({position:{my:"center top+10",at:"center bottom",using:function(e,t){$(this).css(e),$("<div>").addClass("arrow top").addClass(t.vertical).addClass(t.horizontal).appendTo(this)}}})}),L.DomEvent.addListener(i,"click",L.DomEvent.stopPropagation),i},onChange:function(e){this.options.onChange=e},getValue:function(){return this.options.checked},getRadioButtonHTML:function(){var e=this;e.options.buttonGroupId=a.Util.generateId(5);var t=$("<div/>",{id:e.options.buttonGroupId});return t.addClass("r360-box-shadow"),_.each(e.options.buttons,function(i){var n=a.Util.generateId(),o=$("<input/>",{type:"radio",id:"r360_"+n,value:i.key,key:i.key,name:"r360_radiobuttongroup_"+e.options.buttonGroupId}),r=$("<label/>",{"for":"r360_"+n,html:i.label});i.checked&&(e.options.checked=i.key,o.attr({checked:"checked"})),"undefined"!=typeof i.tooltip&&r.attr({title:i.tooltip}),t.append(o),t.append(r)}),t}}),a.radioButtonControl=function(e){return new a.RadioButtonControl(e)},a.CheckboxButtonControl=L.Control.extend({initialize:function(e){this.options=JSON.parse(JSON.stringify(a.config.defaultRadioOptions)),this.options.checked={},"undefined"!=typeof e?("undefined"!=typeof e.position&&(this.options.position=e.position),"undefined"!=typeof e.buttons&&(this.options.buttons=e.buttons),"undefined"!=typeof e.onChange&&(this.options.onChange=e.onChange)):alert("No buttons supplied!")},onAdd:function(e){var t=this;this.options.map=e;var i=L.DomUtil.create("div",this._container);return this.options.input=this.getCheckboxButtonHTML(),$(i).append(this.options.input),$(this.options.input).buttonset({}).change(function(){$("input:checkbox[name='r360_checkboxbuttongroup_"+t.options.buttonGroupId+"']").each(function(){t.options.checked[$(this).attr("key")]=$(this).is(":checked")?!0:!1}),t.options.onChange(t.options.checked)}),$(this.options.input).each(function(){$(this).tooltip({position:{my:"center top+10",at:"center bottom",using:function(e,t){$(this).css(e),$("<div>").addClass("arrow top").addClass(t.vertical).addClass(t.horizontal).appendTo(this)}}})}),L.DomEvent.addListener(i,"click",L.DomEvent.stopPropagation),i},onChange:function(e){this.options.onChange=e},getValue:function(){return this.options.checked},getCheckboxButtonHTML:function(){var e=this;e.options.buttonGroupId=a.Util.generateId(5);var t=$("<div/>",{id:e.options.buttonGroupId});return t.addClass("r360-box-shadow"),_.each(e.options.buttons,function(i){var n=a.Util.generateId(),o=$("<input/>",{type:"checkbox",id:"r360_"+n,value:i.key,key:i.key,name:"r360_checkboxbuttongroup_"+e.options.buttonGroupId}),r=$("<label/>",{"for":"r360_"+n,html:_.isUndefined(i.icon)?""+i.label:i.icon+" "+i.label});i.checked&&(e.options.checked[i.key]=!0,o.attr({checked:"checked"})),"undefined"!=typeof i.tooltip&&r.attr({title:i.tooltip}),t.append(o),t.append(r)}),t}}),a.checkboxButtonControl=function(e){return new a.CheckboxButtonControl(e)},a.polygon=function(e,t,i){return new a.Polygon(e,t,i)},a.Polygon=function(e,t,i){var n=this;n.topRight=new L.latLng(-90,-180),n.bottomLeft=new L.latLng(90,180),n.travelTime=e,n.area=t,n.color,n.outerBoundary=i,n.innerBoundaries=new Array,n.innerProjectedBoundaries=new Array,n.setOuterBoundary=function(e){n.outerBoundary=e},n.projectOuterBoundary=function(){n.outerProjectedBoundary=new Array;for(var e=0;e<n.outerBoundary.length;e++)n.outerProjectedBoundary.push(a.Util.webMercatorToLeaflet(n.outerBoundary[e]))},n.project=function(){n.projectOuterBoundary()},n.addInnerBoundary=function(e){var t={};t.projectedBottomLeft=new L.Point(20026377,20048967),t.projectedTopRight=new L.Point(-20026377,-20048967);for(var i=e.length-1;i>=0;i--)e[i].x>t.projectedTopRight.x&&(t.projectedTopRight.x=e[i].x),e[i].y>t.projectedTopRight.y&&(t.projectedTopRight.y=e[i].y),e[i].x<t.projectedBottomLeft.x&&(t.projectedBottomLeft.x=e[i].x),e[i].y<t.projectedBottomLeft.y&&(t.projectedBottomLeft.y=e[i].y);t.topRight=a.Util.webMercatorToLatLng(new L.Point(t.projectedTopRight.x,t.projectedTopRight.y)),t.bottomLeft=a.Util.webMercatorToLatLng(new L.Point(t.projectedBottomLeft.x,t.projectedBottomLeft.y)),t.projectedBottomLeft=a.Util.webMercatorToLeaflet(t.projectedBottomLeft),t.projectedTopRight=a.Util.webMercatorToLeaflet(t.projectedTopRight),t.points=new Array,n.innerProjectedBoundaries.push(t);for(var o=0;o<e.length;o++)t.points.push(a.Util.webMercatorToLeaflet(e[o]));t.getProjectedBottomLeft=function(){return new L.Point(this.projectedBottomLeft.x,this.projectedBottomLeft.y)},t.getProjectedTopRight=function(){return new L.Point(this.projectedTopRight.x,this.projectedTopRight.y)}},n.getBoundingBox=function(){return new L.LatLngBounds(this._bottomLeft,this._topRight)},n.getProjectedBottomLeft=function(){return new L.Point(n.projectedBottomLeft.x,n.projectedBottomLeft.y)},n.getProjectedTopRight=function(){return new L.Point(n.projectedTopRight.x,n.projectedTopRight.y)},n.setBoundingBox=function(){this.projectedBottomLeft=new L.Point(20026377,20048967),this.projectedTopRight=new L.Point(-20026377,-20048967);for(var e=this.outerBoundary.length-1;e>=0;e--)this.outerBoundary[e].x>this.projectedTopRight.x&&(this.projectedTopRight.x=this.outerBoundary[e].x),this.outerBoundary[e].y>this.projectedTopRight.y&&(this.projectedTopRight.y=this.outerBoundary[e].y),this.outerBoundary[e].x<this.projectedBottomLeft.x&&(this.projectedBottomLeft.x=this.outerBoundary[e].x),this.outerBoundary[e].y<this.projectedBottomLeft.y&&(this.projectedBottomLeft.y=this.outerBoundary[e].y);this.topRight=a.Util.webMercatorToLatLng(new L.Point(this.projectedTopRight.x,this.projectedTopRight.y)),this.bottomLeft=a.Util.webMercatorToLatLng(new L.Point(this.projectedBottomLeft.x,this.projectedBottomLeft.y)),this.projectedTopRight=a.Util.webMercatorToLeaflet(this.projectedTopRight),this.projectedBottomLeft=a.Util.webMercatorToLeaflet(this.projectedBottomLeft)},n.setBoundingBox(),n.getColor=function(){return n.color},n.setTravelTime=function(e){n.travelTime=e},n.getTravelTime=function(){return n.travelTime},n.setColor=function(e){n.color=e},n.setOpacity=function(e){n.opacity=e},n.getOpacity=function(){return n.opacity},n.setArea=function(e){n.area=e},n.getArea=function(){return n.area}},a.MultiPolygon=function(){var e=this;e._topRight=new L.latLng(-90,-180),e._bottomLeft=new L.latLng(90,180),e.travelTime,e.color,e.polygons=new Array,e.addPolygon=function(t){e.polygons.push(t)},e.setOpacity=function(t){e.opacity=t},e.getOpacity=function(){return e.opacity},e.setColor=function(t){e.color=t},e.getColor=function(){return e.color},e.getTravelTime=function(){return e.travelTime},e.setTravelTime=function(t){e.travelTime=t},e.getBoundingBox=function(){return new L.LatLngBounds(e._bottomLeft,e._topRight)},e.setBoundingBox=function(){_.each(e.polygons,function(t){t._topRight.lat>e._topRight.lat&&(e._topRight.lat=t._topRight.lat),t._bottomLeft.lat<e._bottomLeft.lat&&(e._bottomLeft.lat=t._bottomLeft.lat),t._topRight.lng>e._topRight.lng&&(e._topRight.lng=t._topRight.lng),t._bottomLeft.lng<e._bottomLeft.lng&&(e._bottomLeft.lng=t._bottomLeft.lng)})}},a.multiPolygon=function(){return new a.MultiPolygon},a.RouteSegment=function(e){var t=this;if(t.points=[],t.type=e.type,t.travelTime=e.travelTime,t.distance=e.length/1e3,t.warning=e.warning,t.elevationGain=e.elevationGain,t.errorMessage,t.transitSegment=!1,_.each(e.points,function(e){t.points.push(a.Util.webMercatorToLatLng(new L.Point(e[1],e[0]),e[2]))}),e.isTransit){var i=_.findWhere(a.config.routeTypes,{routeType:e.routeType});t.color="undefined"!=typeof i&&_.has(i,"color")?i.color:"RED",t.haloColor="undefined"!=typeof i&&_.has(i,"haloColor")?i.haloColor:"WHITE",t.transitSegment=!0,t.routeType=e.routeType,t.routeShortName=e.routeShortName,t.startname=e.startname,t.endname=e.endname,t.departureTime=e.departureTime,t.arrivalTime=e.arrivalTime,t.tripHeadSign=e.tripHeadSign}else{var i=_.findWhere(a.config.routeTypes,{routeType:e.type});t.color="undefined"!=typeof i&&_.has(i,"color")?i.color:"RED",t.haloColor="undefined"!=typeof i&&_.has(i,"haloColor")?i.haloColor:"WHITE"}t.getPoints=function(){return t.points},t.getType=function(){return t.type},t.getHaloColor=function(){return t.haloColor},t.getColor=function(){return t.color},t.getTravelTime=function(){return t.travelTime},t.getDistance=function(){return t.distance},t.getRouteType=function(){return t.routeType},t.getRouteShortName=function(){return t.routeShortName},t.getStartName=function(){return t.startname},t.getEndName=function(){return t.endname},t.getDepartureTime=function(){return t.departureTime},t.getArrivalTime=function(){return t.arrivalTime},t.getTripHeadSign=function(){return t.tripHeadSign},t.getWarning=function(){return t.warning},t.getElevationGain=function(){return t.elevationGain},t.isTransit=function(){return t.transitSegment}},a.routeSegment=function(e){return new a.RouteSegment(e)},a.Route=function(e,t){var i=this;i.travelTime=e,i.routeSegments=new Array,i.uphillMeter=0,i.downhillMeter=0,i.targetHeight=n,i.sourceHeight=n,_.each(t,function(e){i.routeSegments.push(a.routeSegment(e))}),i.addRouteSegment=function(e){i.routeSegments.push(e)},i.setTravelTime=function(e){i.travelTime=e},i.getDistance=function(){for(var e=0,t=0;t<i.routeSegments.length;t++)e+=i.routeSegments[t].getDistance();return e},i.getElevationGain=function(){for(var e=0,t=0;t<i.routeSegments.length;t++)e+=i.routeSegments[t].getElevationGain();return e},i.getElevations=function(){for(var e={x:[],y:[]},t=0;t<1e3*i.getDistance();t+=100)e.x.push(t/1e3+" km"),e.y.push(i.getElevationAt(t));return e},i.getElevationAt=function(e){for(var t=0,n=i.getPoints().reverse(),o=1;o<n.length;o++){var a=n[o-1],r=n[o],s=a.distanceTo(r);if(t+=s,t>e)return r.alt}},i.getSegments=function(){return i.routeSegments},i.getPoints=function(){var e=[];return _.each(i.routeSegments,function(t){e=e.concat(t.getPoints())}),e},i.getUphillElevation=function(){return i.uphillMeter},i.getDownhillElevation=function(){return i.downhillMeter},i.getTotalElevationDifference=function(){return Math.abs(i.sourceHeight-i.targetHeight)},i.setElevationDifferences=function(){for(var e=i.getPoints(),t=n,o=e.length-1;o>=0;o--)0==o&&(i.targetHeight=e[o].alt),o==e.length-1&&(i.sourceHeight=e[o].alt),"undefined"!=typeof t&&(t>e[o].alt?i.downhillMeter+=t-e[o].alt:t<e[o].alt&&(i.uphillMeter+=e[o].alt-t)),t=e[o].alt}(),i.getTravelTime=function(){return i.travelTime},i.fadeIn=function(e,t,n,o,a){function r(e){segment=i.routeSegments[e],percent="travelTime"==n?segment.getTravelTime()/i.getTravelTime():segment.getDistance()/i.getDistance(),timeToDraw=percent*t,"TRANSFER"!=segment.getType()?p(segment,timeToDraw,o,e):(s(segment),--e>=0&&r(e))}function s(e){console.log(e),l(e.points[0]),e.points.length>1&&e.points[0].lat!=e.points[1].lat&&e.points[0].lng!=e.points[1].lng&&l(e.points[1])}function l(t){var i=L.circleMarker(t,{color:"undefined"!=typeof o&&_.has(o,"color")?o.color:segment.getColor(),fillColor:"undefined"!=typeof o&&_.has(o,"haloColor")?o.haloColor:"undefined"!=typeof segment.getHaloColor()?segment.getHaloColor():"#9D9D9D",fillOpacity:1,opacity:1,stroke:!0,weight:6,radius:10});i.addTo(e),i.bringToFront()}function p(t,i,n,o){var r={};r.color="undefined"!=typeof n&&_.has(n,"color")?n.color:t.getColor(),r.opacity=.8,r.weight=5,"TRANSIT"!=t.getType()&&"WALK"==t.getType()&&(r.weight=7,r.dashArray="1, 10");var s={};s.weight=10,s.opacity=.7,s.color="undefined"!=typeof n&&_.has(n,"haloColor")?n.haloColor:"undefined"!=typeof t.getHaloColor()?t.getHaloColor():"#9D9D9D";var l=i/15,p=u(t.getPoints().reverse(),l),h=L.polyline(p[0],s).addTo(e),g=L.polyline(p[0],r).addTo(e);h.on("click",a),g.on("click",a),d(g,h,p,1,o)}function d(e,t,i,n,o){for(var a=e.getLatLngs(),s=0;s<i[n].length;s++)a.push(i[n][s]);0!=a.length&&(t.setLatLngs(a),e.setLatLngs(a)),++n<i.length?setTimeout(function(){d(e,t,i,n,o)},15):--o>=0&&r(o)}function u(e,t){for(var i,n,o=0,a=1/t,r=0,s=new Array,l=1;l<e.length;l++)o+=e[l-1].distanceTo(e[l]);for(var p=new Array,l=0;l<e.length-1;l++)if(p.push(e[l]),i=e[l].distanceTo(e[l+1]),n=i/o,r+=n,r>=a)for(;r>=a;)percent=(a-(r-n))/n,p.push(h(e[l],e[l+1],percent)),a+=1/t,s.push(p),p=new Array;return s.push(p),p=new Array,p.push(e[e.length-1]),s.push(p),s}function h(t,i,n){var o;o="undefined"!=typeof e.project?e:e._map;var a=o.project(t),r=o.project(i),s=(r.x-a.x)*n+a.x,l=(r.y-a.y)*n+a.y,p=new L.point(s,l),d=o.unproject(p);
return d}"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n="travelTime"),r(i.routeSegments.length-1)}},a.route=function(e,t){return new a.Route(e,t)},a.Route360PolygonLayer=L.Class.extend({initialize:function(e){this.opacity=a.config.defaultPolygonLayerOptions.opacity,this.strokeWidth=a.config.defaultPolygonLayerOptions.strokeWidth,"undefined"!=typeof e&&("undefined"!=typeof e.opacity&&(this.opacity=e.opacity),"undefined"!=typeof e.strokeWidth&&(this.strokeWidth=e.strokeWidth),"undefined"!=typeof e.inverse&&(this.inverse=e.inverse)),this._multiPolygons=new Array,navigator.sayswho=function(){var e,t=navigator.userAgent,i=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(i[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],"IE "+(e[1]||"")):"Chrome"===i[1]&&(e=t.match(/\bOPR\/(\d+)/),null!=e)?"Opera "+e[1]:(i=i[2]?[i[1],i[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&i.splice(1,1,e[1]),i.join(" "))}()},setInverse:function(e){this.inverse=e},getInverse:function(){return this.inverse},getBoundingBox:function(){return new L.LatLngBounds(this._bottomLeft,this._topRight)},onAdd:function(e){this._map=e,this._el=L.DomUtil.create("div","my-custom-layer-"+$(e._container).attr("id")+" leaflet-zoom-hide"),$(this._el).attr("id","canvas"+$(this._map._container).attr("id")),this._map.getPanes().overlayPane.appendChild(this._el),this._map.on("moveend",this._reset,this),this._reset(!0)},fitMap:function(){this._map.fitBounds(this.getBoundingBox())},clearAndAddLayers:function(e){return this.clearLayers(),this.addLayer(e),this},addLayer:function(e){var t=this;if(t.redrawCount=0,a.config.logging)var i=(new Date).getTime();if(t._resetBoundingBox(),t._multiPolygons=new Array,a.config.logging){(new Date).getTime()}for(var n=0;n<e.length;n++)for(var o=0;o<e[n].polygons.length;o++)e[n].polygons[o].project(),t._updateBoundingBox(e[n].polygons[o]),t._addPolygonToMultiPolygon(e[n].polygons[o]);t._multiPolygons.sort(function(e,t){return t.getTravelTime()-e.getTravelTime()}),a.config.logging&&console.log("adding layers took "+((new Date).getTime()-i)),t._reset()},_addPolygonToMultiPolygon:function(e){var t=_.filter(this._multiPolygons,function(t){return t.getTravelTime()==e.travelTime});if(t.length>0)t[0].addPolygon(e);else{var i=new a.multiPolygon;i.setTravelTime(e.travelTime),i.addPolygon(e),i.setColor(e.getColor()),i.setOpacity(e.getOpacity()),this._multiPolygons.push(i)}},_resetBoundingBox:function(){this._latlng=new L.LatLng(-180,90),this._topRight=new L.latLng(-90,-180),this._bottomLeft=new L.latLng(90,180)},addTo:function(e){return e.addLayer(this),this},_updateBoundingBox:function(e){var t=this;e.topRight.lat>t._topRight.lat&&(t._topRight.lat=e.topRight.lat),e.bottomLeft.lat<t._bottomLeft.lat&&(t._bottomLeft.lat=e.bottomLeft.lat),e.topRight.lng>t._topRight.lng&&(t._topRight.lng=e.topRight.lng),e.bottomLeft.lng<t._bottomLeft.lng&&(t._bottomLeft.lng=e.bottomLeft.lng),t._latlng.lat<t._topRight.lat&&(t._latlng.lat=t._topRight.lat),t._latlng.lng>t._bottomLeft.lng&&(t._latlng.lng=t._bottomLeft.lng)},onRemove:function(e){e.getPanes().overlayPane.removeChild(this._el),e.off("viewreset",this._reset,this)},_buildPath:function(e,t){var i=new Array;return i.push(t),i.push(Math.round(e.x)),i.push(Math.round(e.y)),i},_clipToBounds:function(e,t){e.x>t.max.x?e.x=t.max.x:e.x<t.min.x&&(e.x=t.min.x),e.y>t.max.y?e.y=t.max.y:e.y<t.min.y&&(e.y=t.min.y)},_clip:function(e,t){var n,o,a,r,s=function(e){return(o[0]-n[0])*(e[1]-n[1])>(o[1]-n[1])*(e[0]-n[0])},l=function(){var e=[n[0]-o[0],n[1]-o[1]],t=[a[0]-r[0],a[1]-r[1]],i=n[0]*o[1]-n[1]*o[0],s=a[0]*r[1]-a[1]*r[0],l=1/(e[0]*t[1]-e[1]*t[0]);return[(i*t[0]-s*e[0])*l,(i*t[1]-s*e[1])*l]},p=e,n=t[t.length-1];for(j in t){var o=t[j],d=p;p=[],a=d[d.length-1];for(i in d){var r=d[i];s(r)?(s(a)||p.push(l()),p.push(r)):s(a)&&p.push(l()),a=r}n=o}return p},_scale:function(e,t){return e.x*=t,e.y*=t,e},_subtract:function(e,t,i){return e.x-=t,e.y-=i,i},_getMaxDiff:function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},_splicePath:function(e){this._isCollinear()&&e.length>=3&&(e[e.length-1][1]==e[e.length-2][1]&&e[e.length-2][1]==e[e.length-3][1]?e.splice(e.length-2,1):e[e.length-1][2]==e[e.length-2][2]&&e[e.length-2][2]==e[e.length-3][2]&&e.splice(e.length-2,1))},_isCollinear:function(e,t,i){if(e.x==i.x&&e.y==i.y)return!1;if(e.x==t.x&&t.x==i.x)return!0;if(e.y==t.y&&t.y==i.y)return!0;var n=e.x*(t.y-i.y)+t.x*(i.y-e.y)+i.x*(e.y-t.y);return n<a.config.defaultPolygonLayerOptions.tolerance&&n>-a.config.defaultPolygonLayerOptions.tolerance&&e.x!=i.x&&e.y!=i.y?!0:!1},_roundPoint:function(e){return e.x=Math.round(e.x),e.y=Math.round(e.y),e},_buildSVGPolygon:function(e,t,i,n){for(var o,r,s,l,p,d,u=this,h="M",g="L",c="z",f=0,m=[[i.min.x,i.min.y],[i.max.x,i.min.y],[i.max.x,i.max.y],[i.min.x,i.max.y]],y=new Array,v=0;v<t.length;v++)r=t[v],s=new L.Point(r.x,r.y),u._scale(s,n),u._roundPoint(s),o=v>0?u._getMaxDiff(p,s):a.config.defaultPolygonLayerOptions.tolerance,o>=a.config.defaultPolygonLayerOptions.tolerance&&(d=!1,f>2&&(d=u._isCollinear(l,p,s)),d?(y[y.length-1][0]=s.x,y[y.length-1][1]=s.y):(y.push([s.x,s.y]),l=p,p=s,f++));for(var k,T=this._clip(y,m),v=0;v<T.length;v++)r=T[v],s=new L.Point(r[0],r[1]),u._subtract(s,u._map.getPixelOrigin().x+u._offset.x,u._map.getPixelOrigin().y+u._offset.y),e.push(v>0?u._buildPath(s,g):u._buildPath(s,h)),k=s;return e.length>0&&e.push([c]),e},_createSVGData:function(e){var t=this,i=t._map.getPixelBounds(),n=(t._map.getSize(),Math.ceil(a.config.defaultPolygonLayerOptions.strokeWidth/2)),o=Math.ceil(a.config.defaultPolygonLayerOptions.strokeWidth/2);i.max.x+=n,i.min.x-=n,i.max.y+=o,i.min.y-=o;var r=256*Math.pow(2,t._map._zoom),s=new Array,l=e.getProjectedTopRight(),p=e.getProjectedBottomLeft();t._scale(l,r),t._scale(p,r),p.x>i.max.x||l.x<i.min.x||l.y>i.max.y||p.y<i.min.y||t._buildSVGPolygon(s,e.outerProjectedBoundary,i,r);for(var d=0;d<e.innerProjectedBoundaries.length;d++){t.runs++;var l=e.innerProjectedBoundaries[d].getProjectedTopRight(),p=e.innerProjectedBoundaries[d].getProjectedBottomLeft();t._scale(l,r),t._scale(p,r),p.x>i.max.x||l.x<i.min.x||l.y>i.max.y||p.y<i.min.y||t._buildSVGPolygon(s,e.innerProjectedBoundaries[d].points,i,r),t.counter++}return s},clearLayers:function(){$("#canvas"+$(this._map._container).attr("id")).empty(),this.initialize()},_reset:function(){var e=this,t=new Array;if(e.redrawCount++,a.config.logging)var i=(new Date).getTime();if(this._multiPolygons.length>0){var n,o,r=new L.Point(0,0);e._svgWidth=e._map.getSize().x,e._svgHeight=e._map.getSize().y,L.DomUtil.setPosition(this._el,r);var s=$("#svg_"+$(this._map._container).attr("id")),l=s.offset(),p=$(this._map._container).offset();"undefined"==typeof e._offset&&(e._offset=new L.Point(0,0)),"undefined"!=typeof l&&(e._offset.x+=p.left-l.left,e._offset.y+=p.top-l.top),$("#canvas"+$(this._map._container).attr("id")).empty();for(var d=0;d<this._multiPolygons.length;d++){if(o=this._multiPolygons[d],n=new Array,a.config.logging)var u=(new Date).getTime();for(var h=0;h<o.polygons.length;h++){var g=this._createSVGData(o.polygons[h]);n.push(g)}if(a.config.logging&&console.log("svg creation took: "+((new Date).getTime()-u)),0!=n.length){var c=o.getColor(),f=o.getOpacity();if(a.config.logging)var m=(new Date).getTime();var y=e.redrawCount<=2&&a.config.defaultPolygonLayerOptions.animate&&e._isAnimated()?!0:!1;t.push(e.inverse?e._getGElement(n,f,"black",y):e._getGElement(n,1,c,y)),a.config.logging&&console.log("raphael creation took: "+((new Date).getTime()-m)+"  svg path length: "+n.length)}}var v=e.inverse?e._getInverseSvgElement(t):e._getNormalSvgElement(t);$("#canvas"+$(this._map._container).attr("id")).append(v)}a.config.logging&&console.log("layer resetting tool: "+((new Date).getTime()-i)+"ms")},_isAnimated:function(){return-1!=navigator.sayswho.indexOf("IE")?!1:-1!=navigator.sayswho.indexOf("Safari")?!1:-1!=navigator.sayswho.indexOf("Firefox")?!1:a.config.defaultPolygonLayerOptions.animate?!0:!1},_getFrame:function(e,t){var i=new Array;return i.push(["M",0,0]),i.push(["L",e,0]),i.push(["L",e,t]),i.push(["L",0,t]),i.push(["z"]),i},_getTranslation:function(){var e=this;return-1!=navigator.sayswho.indexOf("IE 9")?"transform:translate("+e._offset.x+"px,"+e._offset.y+"px)":-1!=navigator.sayswho.indexOf("Safari")?"-webkit-transform:translate3d("+e._offset.x+"px,"+e._offset.y+"px,0px)":-1!=navigator.sayswho.indexOf("Firefox")?"-moz-transform:translate3d("+e._offset.x+"px,"+e._offset.y+"px,0px)":"transform:translate3d("+e._offset.x+"px,"+e._offset.y+"px,0px)"},_getInverseSvgElement:function(e){for(var t=this,i=this._getFrame(t._svgWidth,t._svgHeight),n="<div id=svg_"+$(this._map._container).attr("id")+" style='"+t._getTranslation()+";''><svg height="+t._svgHeight+" width="+t._svgWidth+" style='fill:"+a.config.defaultPolygonLayerOptions.backgroundColor+" ; opacity: "+a.config.defaultPolygonLayerOptions.backgroundOpacity+"; stroke-width: "+a.config.defaultPolygonLayerOptions.strokeWidth+"; stroke-linejoin:round; stroke-linecap:round; fill-rule: evenodd' xmlns='http://www.w3.org/2000/svg'>",o="</svg></div>",r="",s=0;s<e.length;s++)r+=e[s];var l="<defs><mask id='mask_"+$(this._map._container).attr("id")+"'><path style='fill-opacity:1;stroke: white; fill:white;' d='"+i.toString().replace(/\,/g," ")+"'/>"+r+"</mask></defs>",p="<path style='mask: url(#mask_"+$(this._map._container).attr("id")+")'d='"+i.toString().replace(/\,/g," ")+"'/>";return n+p+l+o},_getGElement:function(e,t,i,n){var o=a.Util.generateId(),r=t,s=a.config.defaultPolygonLayerOptions.animationDuration;return n&&(r=0),"<g id="+o+" style='opacity:"+r+"'><path style='stroke: "+i+"; fill: "+i+" ; stroke-opacity: 1; stroke-width: "+a.config.defaultPolygonLayerOptions.strokeWidth+"; fill-opacity:1'd='"+e.toString().replace(/\,/g," ")+"'/></g><animate xlink:href='#"+o+"' attributeName='opacity' begin='0s' dur='"+s+"s' from="+r+" to="+t+" fill='freeze' />"},_getNormalSvgElement:function(e){for(var t=this,i="<div id=svg_"+$(this._map._container).attr("id")+" style='"+t._getTranslation()+";''><svg height="+t._svgHeight+" width="+t._svgWidth+" style='fill:"+a.config.defaultPolygonLayerOptions.backgroundColor+" ; opacity: "+a.config.defaultPolygonLayerOptions.opacity+"; stroke-linejoin:round; stroke-linecap:round; fill-rule: evenodd' xmlns='http://www.w3.org/2000/svg'>",n="</svg></div>",o="",r=0;r<e.length;r++)o+=e[r];return i+o+n}}),a.route360PolygonLayer=function(e){return new a.Route360PolygonLayer(e)}}(window,document);