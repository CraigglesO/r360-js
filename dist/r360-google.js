/*
 Route360Â° JavaScript API v0.0.9 (9ec6272), a JS library for leaflet maps. http://route360.net
 (c) 2014 Henning Hollburg and Daniel Gerber, (c) 2014 Motion Intelligence GmbH
*/
function GoogleMapsPolygonLayer(t,e){this.map=t,this.id=this.map.getDiv().id,this.inverse=!1,this.topRight={lat:-90,lng:-180},this.bottomLeft={lat:-90,lng:180},this.multiPolygons=[],this.opacity=r360.config.defaultPolygonLayerOptions.opacity,this.strokeWidth=r360.config.defaultPolygonLayerOptions.strokeWidth,this.backgroundColor=r360.config.defaultPolygonLayerOptions.backgroundColor,this.backgroundOpacity=r360.config.defaultPolygonLayerOptions.backgroundOpacity,this.tolerance=r360.config.defaultPolygonLayerOptions.tolerance,this.extendWidthX=r360.config.defaultPolygonLayerOptions.strokeWidth/2,this.extendWidthY=r360.config.defaultPolygonLayerOptions.strokeWidth/2,"undefined"!=typeof e&&("undefined"!=typeof e.opacity&&(this.opacity=e.opacity),"undefined"!=typeof e.strokeWidth&&(this.strokeWidth=e.strokeWidth),"undefined"!=typeof e.inverse&&(this.inverse=e.inverse),"undefined"!=typeof e.tolerance&&(this.tolerance=e.tolerance),"undefined"!=typeof e.extendWidthX&&(this.extendWidthX=e.extendWidthX),"undefined"!=typeof e.extendWidthY&&(this.extendWidthY=e.extendWidthY)),this.element=null,this.setMap(this.map),this.addListener()}window.google&&(GoogleMapsPolygonLayer.prototype=new google.maps.OverlayView,GoogleMapsPolygonLayer.prototype.onAdd=function(){this.element=document.createElement("div"),this.element.id="r360-googlemaps-polygon-layer-canvas-in-"+this.id,this.getPanes().overlayLayer.appendChild(this.element)},GoogleMapsPolygonLayer.prototype.getMapPixelBounds=function(){var t=r360.Util.googleLatlngToPoint(this.map,this.map.getBounds().getSouthWest(),this.map.getZoom()),e=r360.Util.googleLatlngToPoint(this.map,this.map.getBounds().getNorthEast(),this.map.getZoom());return{max:{x:e.x,y:t.y},min:{x:t.x,y:e.y}}},GoogleMapsPolygonLayer.prototype.getPixelOrigin=function(){var t=r360.PolygonUtil.divide({x:this.map.getDiv().offsetWidth,y:this.map.getDiv().offsetHeight},2),e=r360.Util.googleLatlngToPoint(this.map,this.map.getCenter(),this.map.getZoom());return r360.PolygonUtil.roundPoint(r360.PolygonUtil.subtract(e,t.x,t.y))},GoogleMapsPolygonLayer.prototype.setInverse=function(t){console.log("inverse"),this.inverse!=t&&(this.inverse=t,this.draw())},GoogleMapsPolygonLayer.prototype.createSvgData=function(t){var e=r360.PolygonUtil.extendBounds(this.getMapPixelBounds(),this.extendWidthX,this.extendWidthY),o=r360.SvgUtil.createSvgData(t,{bounds:e,scale:256*Math.pow(2,this.map.getZoom()),tolerance:this.tolerance,pixelOrigin:this.getPixelOrigin(),offset:{x:0,y:0}});return o},GoogleMapsPolygonLayer.prototype.draw=function(){if(this.multiPolygons.length>0){this.svgWidth=this.map.getDiv().offsetWidth,this.svgHeight=this.map.getDiv().offsetHeight,r360.DomUtil.setPosition(this.element,{x:0,y:0});var t=$("#svg_"+this.id).offset(),e=$(this.map.getDiv()).offset();"undefined"==typeof this.offset&&(this.offset={x:0,y:0}),"undefined"!=typeof t&&(this.offset.x+=e.left-t.left,this.offset.y+=e.top-t.top),$("#"+this.element.id).empty();for(var o=[],i=0;i<this.multiPolygons.length;i++){for(var n=this.multiPolygons[i],s=[],a=0;a<n.polygons.length;a++)s.push(this.createSvgData(n.polygons[a]));0!=s.length&&o.push(r360.SvgUtil.getGElement(s,{color:this.inverse?"black":n.getColor(),opacity:this.inverse?n.getOpacity():1,strokeWidth:this.strokeWidth}))}var g={id:this.id,offset:this.offset,svgHeight:this.svgHeight,svgWidth:this.svgWidth,backgroundColor:this.backgroundColor,backgroundOpacity:this.backgroundOpacity,opacity:this.opacity,strokeWidth:this.strokeWidth};$("#"+this.element.id).append(this.inverse?r360.SvgUtil.getInverseSvgElement(o,g):r360.SvgUtil.getNormalSvgElement(o,g))}},GoogleMapsPolygonLayer.prototype.update=function(t){this.topRight={lat:-90,lng:-180},this.bottomLeft={lat:-90,lng:180},this.multiPolygons=r360.PolygonUtil.prepareMultipolygons(t,this.topRight,this.bottomLeft),this.setMap(this.getMap()),this.draw()},GoogleMapsPolygonLayer.prototype.addListener=function(){var t=this.map,e=this;google.maps.event.addListener(t,"zoom_changed",function(){e.onRemove(),google.maps.event.addListenerOnce(t,"idle",function(){e.draw()})}),google.maps.event.addListener(t,"dragend",function(){google.maps.event.addListenerOnce(t,"idle",function(){e.draw()})})},GoogleMapsPolygonLayer.prototype.onRemove=function(){$("#"+this.element.id).empty()});